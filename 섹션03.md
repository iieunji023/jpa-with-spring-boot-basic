## Hello JPA - í”„ë¡œì íŠ¸ ìƒì„±

### H2 ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì¹˜

<img src="https://github.com/iieunji023/jpa-with-spring-boot-basic/blob/main/images/h2ì„¤ì¹˜1.png" width="400">

1. https://www.h2database.com ì‚¬ì´íŠ¸ ì ‘ì† > Windows Installer ë‹¤ìš´
2. h2.bat ì‹¤í–‰

```
C:\Users\USER>cd C:\h2-2023-09-17\h2\bin

C:\h2-2023-09-17\h2\bin>h2.bat
```

- cmd ì°½ > h2.batì´ ì„¤ì¹˜ë˜ì–´ ìˆëŠ” í´ë”ë¡œ ì´ë™ í›„ ì‹¤í–‰

<img src="https://github.com/iieunji023/jpa-with-spring-boot-basic/blob/main/images/h2ì„¤ì¹˜2.png" width="400">

- ìë™ìœ¼ë¡œ h2ì°½ì´ ì—´ë¦°ë‹¤
- 100.101.102.189 > localhostë¡œ ë³€ê²½
- JDBC URL: `jdbc:h2:tcp://localhost/~/test` ì…ë ¥ í›„ ì—°ê²°
- `~/test.mv.db` íŒŒì¼ ìƒì„± í™•ì¸

<img src="https://github.com/iieunji023/jpa-with-spring-boot-basic/blob/main/images/h2ì„¤ì¹˜3.png" width="400">

### í”„ë¡œì íŠ¸ ìƒì„±

- ì–¸ì–´: Java 17
- IDE: IntelliJ
- ë¹Œë“œ: Maven
    - groupId: jpa-basic
    - artifactId: ex1-hello-jpa
    - version: 1.0.0

### JPA ì„¤ì •í•˜ê¸° - persistence.xml

- JPA ì„¤ì • íŒŒì¼
- /META-INF/persistence.xml ìœ„ì¹˜
- persistence-unit nameìœ¼ë¡œ ì´ë¦„ ì§€ì •
- jakarta.persistentë¡œ ì‹œì‘: JPA í‘œì¤€ ì†ì„±
- hibernateë¡œ ì‹œì‘: í•˜ì´ë²„ë„¤ì´íŠ¸ ì „ìš© ì†ì„±

ğŸ’¡ ëª‡ë…„ ì „ ê°•ì˜ë¼ ìµœì‹  ë²„ì „ì— ë§ëŠ” í”„ë¡œì íŠ¸ ì†ŒìŠ¤ì½”ë“œë¥¼ ì œê³µí•´ì¤˜ì„œ ë‹¤ìš´ë¡œë“œ ë°›ëŠ” í˜•ì‹ìœ¼ë¡œ ì§„í–‰

### ë°ì´í„°ë² ì´ìŠ¤ ë°©ì–¸

<img src="https://github.com/iieunji023/jpa-with-spring-boot-basic/blob/main/images/ë°ì´í„°ë² ì´ìŠ¤_ë°©ì–¸.png" width="400">

- JPAëŠ” íŠ¹ì • ë°ì´í„°ë² ì´ìŠ¤ì— ì¢…ì†X
- ê°ê°ì˜ ë°ì´í„°ë² ì´ìŠ¤ê°€ ì œê³µí•˜ëŠ” SQL ë¬¸ë²•ê³¼ í•¨ìˆ˜ëŠ” ì¡°ê¸ˆì”© ë‹¤ë¦„
  - ê°€ë³€ ë¬¸ì: MySQLì€ VARCHAR, Oracleì€ VARCHAR2
  - ë¬¸ìì—´ì„ ìë¥´ëŠ” í•¨ìˆ˜: SQL í‘œì¤€ì€ SUBSTRING(), Oracleì€ SUBSTR()
  - í˜ì´ì§•: MySQLì€ LIMIT, Oracleì€ ROWNUM
- ë°©ì–¸: SQL í‘œì¤€ì„ ì§€í‚¤ì§€ ì•ŠëŠ” íŠ¹ì • ë°ì´í„°ë² ì´ìŠ¤ë§Œì˜ ê³ ìœ í•œ ê¸°ëŠ¥

<br>

## Hello JPA - ì• í”Œë¦¬ì¼€ì´ì…˜ ê°œë°œ

### JPA êµ¬ë™ ë°©ì‹
<img src="https://github.com/iieunji023/jpa-with-spring-boot-basic/blob/main/images/jpa_êµ¬ë™ë°©ì‹.png" width="400">

- Persistence í´ë˜ìŠ¤ì—ì„œ ì‹œì‘
- ì„¤ì • ì •ë³´ ì¡°íšŒ
- EntitiyManagerFactory ìƒì„±
- í•„ìš”í•  ë•Œë§ˆë‹¤ EntityManager ìƒì„±

### ì‹¤ìŠµ - JPA ë™ì‘ í™•ì¸
> .java
<details>
      <summary>ì½”ë“œ</summary>

    package hellojpa;

    import jakarta.persistence.*;

    public class  {

    public static void main(String[] args) {

        EntityManagerFactory emf = Persistence.createEntityManagerFactory("hello");
        EntityManager em = emf.createEntityManager();
        //code

        em.close();
        emf.close();
      }
    }

</details>


> í…Œì´ë¸” ìƒì„±

- h2ë°ì´í„°ë² ì´ìŠ¤ ì ‘ì†
```
create table Member(
id bigint not null,
name varchar(255),
primary key(id)
);
```


> ì—”í‹°í‹° ìƒì„± - ê°ì²´ì™€ í…Œì´ë¸” ë§¤í•‘
<br> - Member.java
<details>
      <summary>ì½”ë“œ</summary>


    @Entity // JPAë¥¼ ì‚¬ìš©í•˜ëŠ” í´ë˜ìŠ¤ë¼ëŠ” ê²ƒì„ ì¸ì‹
    public class Member {

    @Id // JPAì—ê²Œ PKê°€ ë­”ì§€ ì•Œë ¤ì¤Œ
    private Long id;
    private String name;

    public Long getId() {
        return id;
    }

    public void setId(Long id) {
        this.id = id;
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
      }
    }

</details>

- `@Entity`: JPAê°€ ê´€ë¦¬í•  ê°ì²´
- `@Id`: ë°ì´í„°ë² ì´ìŠ¤ PKì™€ ë§¤í•‘



### ì‹¤ìŠµ - íšŒì› ì €ì¥

- íšŒì› ë“±ë¡
- íšŒì› ìˆ˜ì •
- íšŒì› ì‚­ì œ
- íšŒì› ë‹¨ ê±´ ì¡°íšŒ

> íšŒì› ë“±ë¡
<br> - .java

<details>
      <summary>ì½”ë“œ</summary>

    public class  {

    public static void main(String[] args) {

        EntityManagerFactory emf = Persistence.createEntityManagerFactory("hello");
        EntityManager em = emf.createEntityManager();

        EntityTransaction tx = em.getTransaction();
        tx.begin();

        try{
            Member member = new Member();
            member.setId(2L);
            member.setName("HelloB");

            em.persist(member); // member ì €ì¥

            tx.commit();
        } catch (Exception e){
            tx.rollback();
        }finally {
            em.close();
        }
        emf.close();
      }
    }

</details>

- `EntityTransaction`ì„ ì‚¬ìš©í•´ì„œ DBì— ì €ì¥
- ì¶œë ¥ ê²°ê³¼
  ```
  Hibernate: 
    /* insert for
        hellojpa.Member */insert 
    into
        Member (name, id) 
    values
        (?, ?)
  ```
  - persistence.xmlì—ì„œ ì„¤ì •í•´ì¤¬ê¸° ë•Œë¬¸ì— ì¿¼ë¦¬ë¬¸ì´ ì¶œë ¥ë˜ëŠ” ê²ƒ

> H2 ì½˜ì†”ì—ì„œ í™•ì¸

<img src="https://github.com/iieunji023/jpa-with-spring-boot-basic/blob/main/images/h2_ì½˜ì†”.png" width="400">

- SELECTë¬¸ì„ ì‹¤í–‰í•œ ê²°ê³¼ ê°’ì´ ì €ì¥ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤
- í…Œì´ë¸” ì´ë¦„ì„ ì„¤ì •í•˜ì§€ë„ ì•Šì•˜ëŠ”ë° ì–´ë–»ê²Œ Member í…Œì´ë¸”ì„ ì°¾ì„ê¹Œâ“
  - í´ë˜ìŠ¤ëª…ê³¼ í…Œì´ë¸”ëª…ì„ ë˜‘ê°™ì´ í•˜ë©´ JPAê°€ ìë™ìœ¼ë¡œ ë§¤ì¹­í•´ì„œ ì €ì¥í•œë‹¤
  - ë§Œì•½ í´ë˜ìŠ¤ëª…ê³¼ í…Œì´ë¸”ëª…ì´ ë‹¤ë¥¼ ê²½ìš°
    - `@Table(name = â€œUSERâ€)`ì„ í†µí•´ í…Œì´ë¸” ì´ë¦„ì„ ì„¤ì •í•´ì£¼ë©´ ëœë‹¤!
    - `@Column(name = â€usernameâ€)` ì»¬ëŸ¼ì˜ ê²½ìš°

> Member ì¡°íšŒ

<details>
      <summary>ì½”ë“œ</summary>

    Member findMember = em.find(Member.class, 2L);
    
    System.out.println("findMember.getId() = " + findMember.getId());
    System.out.println("findMember.getName() = " + findMember.getName());

</details>

> Member ì‚­ì œ

<details>
      <summary>ì½”ë“œ</summary>

    Member findMember = em.find(Member.class, 2L);
    
    System.out.println("findMember.getId() = " + findMember.getId());
    System.out.println("findMember.getName() = " + findMember.getName());

</details>

- EntityManagerì—ì„œ ì œê³µí•˜ëŠ” remove() ë©”ì„œë“œë¥¼ í†µí•´ ì‚­ì œ

> Member ìˆ˜ì •

<details>
      <summary>ì½”ë“œ</summary>

    Member findMember = em.find(Member.class, 1L);
    findMember.setName("HelloJPA");

</details>

- em.persist();ë¡œ ë”°ë¡œ ì €ì¥í•´ì£¼ì§€ ì•Šì•„ë„ ìë°” ê°ì²´ì—ì„œ ê°’ë§Œ ë³€ê²½í•´ë„ DB ìˆ˜ì •ë¨

<details>
      <summary>âš ï¸ Member í…Œì´ë¸”ì´ drop ë˜ëŠ” ë¬¸ì œ</summary>

- ì˜¤ë¥˜
  ```
  Hibernate: drop table Member if exists
  ```
- ì›ì¸
  - persistenceë¥¼ ì„¤ì •í•˜ëŠ” persistence.xml íŒŒì¼ì—ì„œ ì„¤ì •ë¬¸ì œ
- í•´ê²°
  - `<property name="hibernate.hbm2ddl.auto" value="create" />` ì´ ì½”ë“œë¥¼ ì£¼ì„ì²˜ë¦¬í•˜ë‹ˆê¹Œ í•´ê²°ë¨
    ```
    ğŸ’¡ hibernate hbm2ddl.auto
      - SessionFactoryê°€ ìƒì„±ë  ë•Œ ìŠ¤í‚¤ë§ˆ DDLì„ dbë¡œ ê²€ì¦í•˜ê³  ë‚´ë³´ë‚´ëŠ” ê¸°ëŠ¥ì„ ìƒí™©ì— ë”°ë¼ ë‹¤ë¥´ê²Œ ì„¤ì •í•  ìˆ˜ ìˆë„ë¡ í•˜ëŠ” í”„ë¡œí¼í‹°
      - ì˜µì…˜
        - create: SessionFactory ì‹œì‘ì‹œ ìŠ¤í‚¤ë§ˆë¥¼ ì‚­ì œí•˜ê³  ë‹¤ì‹œ ìƒì„±
        - create-drop: SessionFactory ì¢…ë£Œì‹œ ìŠ¤í‚¤ë§ˆë¥¼ ì‚­ì œ
        - update: SessionFactory ì‹œì‘ì‹œ ê°ì²´ êµ¬ì„±ì™€ ìŠ¤í‚¤ë§ˆë¥¼ ë¹„êµí•˜ì—¬ ì»¬ëŸ¼ ì¶”ê°€/ì‚­ì œ ì‘ì—…ì„ ì§„í–‰í•¨. ê¸°ì¡´ì˜ ìŠ¤í‚¤ë§ˆë¥¼ ì‚­ì œí•˜ì§€ ì•Šê³  ìœ ì§€.
        - validate: SessionFactory ì‹œì‘ì‹œ ê°ì²´êµ¬ì„±ê³¼ ìŠ¤í‚¤ë§ˆê°€ ë‹¤ë¥´ë‹¤ë©´ ì˜ˆì™¸ ë°œìƒì‹œí‚´.
        ```
</details>

> âš ï¸ ì£¼ì˜
<br> - ì—”í‹°í‹° ë§¤ë‹ˆì € íŒ©í† ë¦¬ëŠ” í•˜ë‚˜ë§Œ ìƒì„±í•´ì„œ ì• í”Œë¦¬ì¼€ì´ì…˜ ì „ì²´ì—ì„œ ê³µìœ 
<br> - ì—”í‹°í‹° ë§¤ë‹ˆì €ëŠ” ì“°ë ˆë“œ ê°„ì— ê³µìœ X(ì‚¬ìš©í•˜ê³  ë²„ë ¤ì•¼ í•¨)
<br> - JPAì˜ ëª¨ë“  ë°ì´í„° ë³€ê²½ì€ íŠ¸ëœì­ì…˜ ì•ˆì—ì„œ ì‹¤í–‰

### JPQL

- ê°€ì¥ ë‹¨ìˆœí•œ ì¡°íšŒ ë°©ë²•
  - EntityManager.find()
  - ê°ì²´ ê·¸ë˜í”„ íƒìƒ‰(a.getB().getC())
- JPQLì„ ì‚¬ìš©í•˜ëŠ” ì´ìœ ?
  - JPAë¥¼ ì‚¬ìš©í•˜ë©´ ì—”í‹°í‹° ê°ì²´ë¥¼ ì¤‘ì‹¬ìœ¼ë¡œ ê°œë°œ
  - ë¬¸ì œëŠ” ê²€ìƒ‰ ì¿¼ë¦¬â­
  - ê²€ìƒ‰ì„ í•  ë•Œë„ **í…Œì´ë¸”ì´ ì•„ë‹Œ ì—”í‹°í‹° ê°ì²´ë¥¼ ëŒ€ìƒìœ¼ë¡œ ê²€ìƒ‰**
  - ëª¨ë“  DB ë°ì´í„°ë¥¼ ê°ì²´ë¡œ ë³€í™˜í•´ì„œ ê²€ìƒ‰í•˜ëŠ” ê²ƒì€ ë¶ˆê°€ëŠ¥
  - ì• í”Œë¦¬ì¼€ì´ì…˜ì´ í•„ìš”í•œ ë°ì´í„°ë§Œ DBì—ì„œ ë¶ˆëŸ¬ì˜¤ë ¤ë©´ ê²°êµ­ ê²€ìƒ‰ ì¡°ê±´ì´ í¬í•¨ëœ SQLì´ í•„ìš”
  - JPAëŠ” SQLì„ ì¶”ìƒí™”í•œ **JPQL**ì´ë¼ëŠ” **ê°ì²´ ì§€í–¥ ì¿¼ë¦¬ ì–¸ì–´ ì œê³µ**
  - SQLê³¼ ë¬¸ë²• ìœ ì‚¬, SELECT, FROM, WHERE, GROUP BY, HAVING, JOIN ì§€ì›
- JPQL vs SQL
  - JPQLì€ ì—”í‹°í‹° ê°ì²´ë¥¼ ëŒ€ìƒìœ¼ë¡œ ì¿¼ë¦¬
  - SQLì€ ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸”ì„ ëŒ€ìƒìœ¼ë¡œ ì¿¼ë¦¬
- JPQL
  - í…Œì´ë¸”ì´ ì•„ë‹Œ ê°ì²´ë¥¼ ëŒ€ìƒìœ¼ë¡œ ê²€ìƒ‰í•˜ëŠ” ê°ì²´ ì§€í–¥ ì¿¼ë¦¬
  - SQLì„ ì¶”ìƒí™”í•´ì„œ íŠ¹ì • ë°ì´í„°ë² ì´ì„œ SQLì— ì˜ì¡´X
  - JPQLì„ í•œë§ˆë””ë¡œ ì •ì˜í•˜ë©´ ê°ì²´ì§€í–¥ SQL

### ì‹¤ìŠµ - JPQL

- JPQLë¡œ ì „ì²´ íšŒì› ê²€ìƒ‰
- JPQLë¡œ IDê°€ 2 ì´ìƒì¸ íšŒì›ë§Œ ê²€ìƒ‰
- JPQLë¡œ ì´ë¦„ì´ ê°™ì€ íšŒì›ë§Œ ê²€ìƒ‰
- JPQLì— ëŒ€í•´ ìì„¸í•œ ë‚´ìš©ì€ ê°ì²´ì§€í–¥ ì¿¼ë¦¬ì—ì„œ í•™ìŠµ

> ì¡°íšŒ
<details>
      <summary>ì½”ë“œ</summary>

    List<Member> result = em.createQuery("select m from Member as m", Member.class).getResultList();
    
    for (Member member : result) {
    System.out.println("member.getName() = " + member.getName());
    }

</details>

- JPAëŠ” í…Œì´ë¸”ì„ ëŒ€ìƒìœ¼ë¡œ ì¿¼ë¦¬ë¥¼ ì§œëŠ” ê²ƒX
- **ë©¤ë²„ ê°ì²´**ë¥¼ ëŒ€ìƒìœ¼ë¡œ ì¡°íšŒ
- ë©¤ë²„ ì—”í‹°í‹°ë¥¼ ì„ íƒ