## 프록시

### 프록시 기초

<img src="https://github.com/iieunji023/jpa-with-spring-boot-basic/blob/main/images/프록시1.png" width="450">

- em.find() vs em.getReference()
- em.find()
    - 데이터베이스를 통해서 실제 엔티티 객체 조회
    - DB에 쿼리가 날라감
      - 예시
        <details>
          <summary>JpaMain.java</summary>

          ```
          Member member = new Member();
          member.setUsername("hello");
            
          em.persist(member);
            
          em.flush();
          em.clear();
            
          Member findMember = em.find(Member.class, member.getId());
          System.out.println("findMember = " + findMember.getId());
          System.out.println("findMember = " + findMember.getUsername());
            
          tx.commit();
        
          ```

        </details>
        <details>
          <summary>출력 결과</summary>

          ```
          Hibernate: 
          select
          m1_0.MEMBER_ID,
          m1_0.INSERT_MEMBER,
          m1_0.createdDate,
          m1_0.UPDATE_MEMBER,
          m1_0.lastModifiedDate,
          t1_0.TEAM_ID,
          t1_0.INSERT_MEMBER,
          t1_0.createdDate,
          t1_0.UPDATE_MEMBER,
          t1_0.lastModifiedDate,
          t1_0.name,
          m1_0.USERNAME
          from
          Member m1_0
          left join
          Team t1_0
          on t1_0.TEAM_ID=m1_0.TEAM_ID
          where
          m1_0.MEMBER_ID=?
          findMember = 1
          findMember = hello
        
          ```
            
          - DB에서 select문을 통해 조회

        </details>
        
- em.getReference()
  - 데이터베이스 조회를 미루는 가짜(프록시) 엔티티 객체 조회
  - DB에 쿼리가 날라가지 않지만, 객체가 조회됨
  - 예시
    <details>
       <summary>JpaMain.java</summary>
    
       ```
       Member findMember = em.getReference(Member.class, member.getId());
      System.out.println("findMember = " + findMember.getClass());
      System.out.println("findMember.id = " + findMember.getId());
      System.out.println("findMember.username = " + findMember.getUsername());
          
      ```
    
    </details>
    
    <details>
       <summary>출력 결과</summary>
    
       ```
       findMember = class hellojpa.Member$HibernateProxy$SZ5U9vGf
       findMember.id = 1
       Hibernate:
           select
             m1_0.MEMBER_ID,
             m1_0.INSERT_MEMBER,
             m1_0.createdDate,
             m1_0.UPDATE_MEMBER,
             m1_0.lastModifiedDate,
             t1_0.TEAM_ID,
             t1_0.INSERT_MEMBER,
             t1_0.createdDate,
             t1_0.UPDATE_MEMBER,
             t1_0.lastModifiedDate,
             t1_0.name,
             m1_0.USERNAME
           from
             Member m1_0
           left join
             Team t1_0
                  on t1_0.TEAM_ID=m1_0.TEAM_ID
           where
             m1_0.MEMBER_ID=?
             findMember.username = hello
    
       ```
    
       - `indMember.getId()` 가 출력될 때까지는 select문으로 조회하지 않음
       - `getReference()`할 때 `findMember.getId()`를 참조했기 때문!
       - `findMember.getClass()`를 출력해보니 member객체가 아니라 뒤에 $HibernateProxy$라는 것이 붙어있음(아래 설명!)
    
    </details>
    