## ê°ì²´ì™€ í…Œì´ë¸” ë§¤í•‘

### ì—”í‹°í‹° ë§¤í•‘ ì†Œê°œ

- ê°ì²´ì™€ í…Œì´ë¸” ë§¤í•‘: `@Entity`, `@Table`
- í•„ë“œì™€ ì»¬ëŸ¼ ë§¤í•‘: `@Column`
- ê¸°ë³¸ í‚¤ ë§¤í•‘: `@Id`
- ì—°ê´€ê´€ê³„ ë§¤í•‘: `@ManyToOne`, `@JoinColumn`

> **@Entity**

- `@Entity` ê°€ ë¶™ì€ í´ë˜ìŠ¤ëŠ” JPAê°€ ê´€ë¦¬, ì—”í‹°í‹°ë¼ í•œë‹¤.
- JPAë¥¼ ì‚¬ìš©í•´ì„œ í…Œì´ë¸”ê³¼ ë§¤í•‘í•  í´ë˜ìŠ¤ëŠ” `@Entity` í•„ìˆ˜
- âš ï¸ ì£¼ì˜
    - ê¸°ë³¸ ìƒì„±ì í•„ìˆ˜(íŒŒë¼ë¯¸í„°ê°€ ì—†ëŠ” public ë˜ëŠ” protexted ìƒì„±ì)
    - final í´ë˜ìŠ¤, enum, interface, inner í´ë˜ìŠ¤ ì‚¬ìš© X
    - ì €ì¥í•  í•„ë“œì— final ì‚¬ìš© X

> **@Entity ì†ì„± ì •ë¦¬**

- ì†ì„±: name
    - JPAì—ì„œ ì‚¬ìš©í•  ì—”í‹°í‹° ì´ë¦„ì„ ì§€ì •í•œë‹¤.
    - ê¸°ë³¸ê°’: í´ë˜ìŠ¤ ì´ë¦„ì„ ê·¸ëŒ€ë¡œ ì‚¬ìš©(ì˜ˆ: Member)
    - ê°™ì€ í´ë˜ìŠ¤ ì´ë¦„ì´ ì—†ìœ¼ë©´ ê°€ê¸‰ì  ê¸°ë³¸ê°’ì„ ì‚¬ìš©í•œë‹¤.

> **@Table**

- `@Table`ì€ ì—”í‹°í‹°ì™€ ë§¤í•‘í•  í…Œì´ë¸” ì§€ì •

  |ì†ì„±|ê¸°ëŠ¥|ê¸°ë³¸ê°’|
  |---|---|---|
  |name|ë§¤í•‘í•  í…Œì´ë¸” ì´ë¦„|ì—”í‹°í‹° ì´ë¦„ì„ ì‚¬ìš©|
  |catalog|ë°ì´í„°ë² ì´ìŠ¤ catalog ë§¤í•‘||
  |schema|ë°ì´í„°ë² ì´ìŠ¤ schema ë§¤í•‘||
  |uniqueConstraints(DDL)|DDL ìƒì„±ì‹œ ìœ ë‹ˆí¬ ì œì•½ì¡°ê±´ ìƒì„±||

<br>

## ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ìë™ ìƒì„±

- DDLì„ ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰ ì‹œì ì— ìë™ ìƒì„±
- í…Œì´ë¸” ì¤‘ì‹¬ â†’ ê°ì²´ ì¤‘ì‹¬
- ë°ì´í„°ë² ì´ìŠ¤ ë°©ì–¸ì„ í™œìš©í•´ì„œ ë°ì´í„°ë² ì´ìŠ¤ì— ë§ëŠ” ì ì ˆí•œ DDL ìƒì„±
- ì´ë ‡ê²Œ **ìƒì„±ëœ DDLì€ ê°œë°œ ì¥ë¹„ì—ì„œë§Œ ì‚¬ìš©**
- ìƒì„±ëœ DDLì€ ìš´ì˜ì„œë²„ì—ì„œëŠ” ì‚¬ìš©í•˜ì§€ ì•Šê±°ë‚˜, ì ì ˆíˆ ë‹¤ë“¬ì€ í›„ ì‚¬ìš©

### ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ìë™ ìƒì„± - ì†ì„±

- hibernate.hbm2ddl.auto

  |ì˜µì…˜|ì„¤ëª…|
    |--|---|
  |create|ê¸°ì¡´í…Œì´ë¸” ì‚­ì œ í›„ ë‹¤ì‹œ ìƒì„±(DROP + CREATE)|
  |create-drop|createì™€ ê°™ìœ¼ë‚˜ ì¢…ë£Œì‹œì ì— í…Œì´ë¸” DROP|
  |update|ë³€ê²½ë¶„ë§Œ ë°˜ì˜(ìš´ì˜ DBì—ëŠ” ì‚¬ìš©í•˜ë©´ ì•ˆë¨)|
  |validate|ì—”í‹°í‹°ì™€ í…Œì´ë¸”ì´ ì •ìƒ ë§¤í•‘ë˜ì—ˆëŠ”ì§€ë§Œ í™•ì¸|
  |none|ì‚¬ìš©í•˜ì§€ ì•ŠìŒ|

### ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ìë™ ìƒì„± - ì‹¤ìŠµ

> create

- ì¶œë ¥ ê²°ê³¼
```
Hibernate: 
    drop table if exists Member cascade 
Hibernate: 
    create table Member (
        id bigint not null,
        name varchar(10) unique,
        primary key (id)
    )

Hibernate: 
    select
        m1_0.id,
        m1_0.name 
    from
        Member m1_0 
    where
        m1_0.id=?
```
- ê¸°ì¡´ í…Œì´ë¸” ì‚­ì œ í›„ í…Œì´ë¸”ì´ ìƒì„±ë˜ëŠ” ê²ƒì„ í™•ì¸

> create-drop

- ì¶œë ¥ê²°ê³¼

```
Hibernate: 
    drop table if exists Member cascade 
Hibernate: 
    create table Member (
        id bigint not null,
        name varchar(10) unique,
        primary key (id)
    )
Hibernate: 
    select
        m1_0.id,
        m1_0.name 
    from
        Member m1_0 
    where
        m1_0.id=?
Hibernate: 
    drop table if exists Member cascade 
```

- ê¸°ì¡´ í…Œì´ë¸” ì‚­ì œ í›„ í…Œì´ë¸”ì´ ìƒì„±ë˜ëŠ” ê²ƒì€ **createì™€ ë™ì¼**
- ì„œë¹„ìŠ¤ ì¢…ë£Œ ì‹œì ì— í…Œì´ë¸”ì„ ì‚­ì œ

> update

- ì¶œë ¥ ê²°ê³¼

```
Hibernate: 
    create table Member (
        id bigint not null,
        email varchar(255),
        name varchar(10),
        primary key (id)
    )
Hibernate: 
    alter table if exists Member 
       drop constraint if exists UK_ektea7vp6e3low620iewuxhlq
Hibernate: 
    alter table if exists Member 
       add constraint UK_ektea7vp6e3low620iewuxhlq unique (name)
Hibernate: 
    select
        m1_0.id,
        m1_0.email,
        m1_0.name 
    from
        Member m1_0 
    where
        m1_0.id=?
```

- í…Œì´ë¸”ì— email ì»¬ëŸ¼ì„ ì¶”ê°€í•˜ê³  ì‹¶ì€ë° createê°€ ì•„ë‹Œ alterë¥¼ í•˜ê³  ì‹¶ì„ ë•Œ
- ì‚­ì œí•  ë•ŒëŠ” ì ìš© ì•ˆë¨(âŒâŒâŒ)

> validate

- ì¶œë ¥ ê²°ê³¼

```
Caused by: org.hibernate.tool.schema.spi.SchemaManagementException: Schema-validation: missing column [phone] in table [Member]
```

- Member ì—”í‹°í‹°ì— phone í•„ë“œë¥¼ ì¶”ê°€í•˜ê³  ëŒë ¤ë³´ë©´ ì—ëŸ¬ ë°œìƒ

### ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ìë™ ìƒì„± - ì£¼ì˜

- ìš´ì˜ ì¥ë¹„ì—ëŠ” ì ˆëŒ€ create, create-drop, updateë¥¼ ì‚¬ìš©í•˜ë©´ ì•ˆëœë‹¤.
- ê°œë°œ ì´ˆê¸° ë‹¨ê³„ëŠ” create ë˜ëŠ” update
- í…ŒìŠ¤íŠ¸ ì„œë²„ëŠ” update ë˜ëŠ” validate
- ìŠ¤í…Œì´ì§•ê³¼ ìš´ì˜ ì„œë²„ëŠ” validate ë˜ëŠ” none

### DDL ìƒì„± ê¸°ëŠ¥

- ì œì•½ì¡°ê±´ ì¶”ê°€: íšŒì› ì´ë¦„ì€ í•„ìˆ˜, 10ì ì´ˆê³¼X
    - `@Column(nullable = false, length = 10)`
- ìœ ë‹ˆí¬ ì œì•½ì¡°ê±´ ì¶”ê°€
    - `@Table(uniqueConstraints = {@UniqueConstraint( name = "NAME_AGE_UNIQUE",
    columnNames = {"NAME", "AGE"} )})`
- ì‹¤ìŠµ
    - `@Column(unique = true, length = 10)`

```
create table Member (
        id bigint not null,
        name varchar(10) unique,
        email varchar(255),
        phone varchar(255),
        primary key (id)
    )
```

- DDL ìƒì„± ê¸°ëŠ¥ì€ DDLì„ ìë™ ìƒì„±í•  ë•Œë§Œ ì‚¬ìš©ë˜ê³  JPAì˜ ì‹¤í–‰ ë¡œì§ì—ëŠ” ì˜í–¥ì„ ì£¼ì§€ ì•ŠëŠ”ë‹¤.
- JPA ì‹¤í–‰ ë§¤ì»¤ë‹ˆì¦˜ì— ì˜í–¥ì„ ì£¼ì§€ëŠ” ì•ŠìŒ
- DBì— ì˜í–¥ì„ ì£¼ëŠ” ê²ƒ

<br>

## í•„ë“œì™€ ì»¬ëŸ¼ ë§¤í•‘

```
ğŸ’¡ìš”ì²­ì‚¬í•­ ì¶”ê°€
1. íšŒì›ì€ ì¼ë°˜íšŒì›ê³¼ ê´€ë¦¬ìë¡œ êµ¬ë¶„í•´ì•¼ í•œë‹¤.
2. íšŒì› ê°€ì…ì¼ê³¼ ìˆ˜ì •ì¼ì´ ìˆì–´ì•¼ í•œë‹¤.
3. íšŒì›ì„ ì„¤ëª…í•  ìˆ˜ ìˆëŠ” í•„ë“œê°€ ìˆì–´ì•¼ í•œë‹¤. ì´ í•„ë“œëŠ” ê¸¸ì´ ì œí•œì´ ì—†ë‹¤.
```

<details>
      <summary>Member.java</summary>

    @Entity
    public class Member {

    @Id 
    private Long id;

    @Column(name = "name")  
    private String username;

    private Integer age;

    @Enumerated(EnumType.STRING)   
    private RoleType roleType;

    @Temporal(TemporalType.TIMESTAMP) 
    private Date createdDate;

    @Temporal(TemporalType.TIMESTAMP)
    private Date lastModifiedDate;

    @Lob    
    private String description;

		@Transient 
    private int temp;

    public Member() {

    }
    } 

- @Entity: JPAë¥¼ ì‚¬ìš©í•˜ëŠ” í´ë˜ìŠ¤ë¼ëŠ” ê²ƒì„ ì¸ì‹
- @Id: JPAì—ê²Œ PKê°€ ë­”ì§€ ì•Œë ¤ì¤Œ
- @Enumerated(EnumType.STRING): ê°ì²´ì—ì„œ ENUM íƒ€ì…ì„ ì“°ê³  ì‹¶ì„ ë•Œ
- @Temporal(TemporalType.TIMESTAMP): ë‚ ì§œ,ì‹œê°„ ëª¨ë‘ í¬í•¨
- @Lob: DBì— í° ì»¨í…ì¸ ë¥¼ ë„£ê³  ì‹¶ì„ ë•Œ
- @Transient: DBì— ì¶”ê°€X, ë©”ëª¨ë¦¬ì—ì„œ ì“°ê² ë‹¤ëŠ” ì˜ë¯¸

</details>

- í…Œì´ë¸” ìë™ ìƒì„±

    ```
    Hibernate: 
        create table Member (
            age integer,
            createdDate timestamp(6),
            id bigint not null,
            lastModifiedDate timestamp(6),
            name varchar(255),
            roleType varchar(255) check (roleType in ('USER','ADMIN')),
            description clob,
            primary key (id)
        )
    ```

### ë§¤í•‘ ì–´ë…¸í…Œì´ì…˜ ì •ë¦¬

|ì–´ë…¸í…Œì´ì…˜|ì„¤ëª…|
|---|--------------------------|
|@Column| ì»¬ëŸ¼ ë§¤í•‘                    |
|@Temporal| ë‚ ì§œ íƒ€ì… ë§¤í•‘                 |
|@Enumerated| enum íƒ€ì… ë§¤í•‘               |
|@Lob| BLOB, CLOB ë§¤í•‘            |
|@Transient| íŠ¹ì • í•„ë“œë¥¼ ì»¬ëŸ¼ì— ë§¤í•‘í•˜ì§€ ì•ŠìŒ(ë§¤í•‘ ë¬´ì‹œ) |

### @Column

| ì†ì„±                  | ì„¤ëª…                                                                                                                                                                 | ê¸°ë³¸ê°’                  |
|---------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------------------|
| name                | í•„ë“œì™€ ë§¤í•‘í•  í…Œì´ë¸”ì˜ ì»¬ëŸ¼ ì´ë¦„                                                                                                                                                 | ê°ì²´ì˜ í•„ë“œ ì´ë¦„            |
| insertable, updatable | ë“±ë¡, ë³€ê²½ ê°€ëŠ¥ ì—¬ë¶€                                                                                                                                                       | TRUE                 |
| nullable(DDL)             | null ê°’ì˜ í—ˆìš© ì—¬ë¶€ë¥¼ ì„¤ì •í•œë‹¤. falseë¡œ ì„¤ì •í•˜ë©´ DDL ìƒì„± ì‹œì— not null ì œì•½ì¡°ê±´ì´ ë¶™ëŠ”ë‹¤.                                                                                                     |                      |
| unique(DDL) | @Tableì˜ uniqueConstraintsì™€ ê°™ì§€ë§Œ í•œ ì»¬ëŸ¼ì— ê°„ë‹¨íˆ ìœ ë‹ˆí¬ ì œì•½ ì¡°ê±´ì„ ê±¸ ë•Œ ì‚¬ìš©í•œë‹¤.     |  |
|columnDefinition(DDL)| ë°ì´í„°ë² ì´ìŠ¤ ì»¬ëŸ¼ ì •ë³´ë¥¼ ì§ì ‘ ì¤„ ìˆ˜ ìˆë‹¤. <br> ex) varchar(100) default â€˜EMPTYâ€™|í•„ë“œì˜ ìë°” íƒ€ì…ê³¼ ë°©ì–¸ ì •ë³´ë¥¼ ì‚¬ìš© |
|length(DDL)| ë¬¸ì ê¸¸ì´ ì œì•½ì¡°ê±´, String íƒ€ì…ì—ë§Œ ì‚¬ìš©í•œë‹¤.| 255                  |
|precision,scale(DDL)| BigDecimal íƒ€ì…ì—ì„œ ì‚¬ìš©í•œë‹¤(BigIntegerë„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤).<br>precisionì€ ì†Œìˆ˜ì ì„ í¬í•¨í•œ ì „ì²´ ìë¦¿ìˆ˜ë¥¼, scaleì€ ì†Œìˆ˜ì˜ ìë¦¿ìˆ˜ë‹¤. <br> ì°¸ê³ ë¡œ double, float íƒ€ì…ì—ëŠ” ì ìš©ë˜ì§€ ì•ŠëŠ”ë‹¤. ì•„ì£¼ í° ìˆ«ìë‚˜ ì •ë°€í•œ ì†Œìˆ˜ë¥¼ ë‹¤ë£¨ì–´ì•¼ í•  ë•Œë§Œ ì‚¬ìš©í•œë‹¤. |precision=19,scale=2|

- insertable
  - ìˆ˜ì •í–ˆì„ ë•Œ DBì— INSERTí• ê±´ì§€
- updatetable
  - ìˆ˜ì •í–ˆì„ ë•Œ DBì— UPDATE í• ê±´ì§€
- nullable
  - not null ì œì•½ì¡°ê±´
  - falseì¼ ë•Œ NOT NULL

### @Enumerated

- ìë°” enum íƒ€ì…ì„ ë§¤í•‘í•  ë•Œ ì‚¬ìš©
- âš ï¸ ì£¼ì˜! ORDINAL ì‚¬ìš© X
  - ORDINALì€ ENUM ìˆœì„œë¥¼ ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥
    - ex) USER, ADMIN, GUESTë©´ 0,1,2 ìˆœì„œë¡œ ì €ì¥
  - ì´ëŸ° ê²½ìš° ENUM í´ë˜ìŠ¤ í•„ë“œë¥¼ ì¶”ê°€í•  ë•Œ ì•ìª½ì— ìœ„ì¹˜í•˜ê²Œ ë˜ë©´ 0ìœ¼ë¡œ ì €ì¥ë¨ â†’ ê²¹ì¹˜ê²Œ ë˜ë¯€ë¡œ ì–´ë–¤ í•„ë“ ì§€ êµ¬ë¶„í•  ìˆ˜ ì—†ìŒ
  - ë”°ë¼ì„œ STRINGìœ¼ë¡œ ì‚¬ìš© â­

|ì†ì„±| ì„¤ëª…                  |ê¸°ë³¸ê°’|
|---|---------------------|---|
|value|EnumType.ORDINAL: enum ìˆœì„œë¥¼ ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥|EnumType.ORDINAL|
||EnumType.STRING: enum ì´ë¦„ì„ ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥||

### Temporal

- ë‚ ì§œ íƒ€ì…(java.util.Date, java.util.Calendar)ì„ ë§¤í•‘í•  ë•Œ ì‚¬ìš©

|ì†ì„±| ì„¤ëª…                                                                                    |ê¸°ë³¸ê°’|
|---|---------------------------------------------------------------------------------------|--|
|value| TemporalType.DATE: ë‚ ì§œ, ë°ì´í„°ë² ì´ìŠ¤ date íƒ€ì…ê³¼ ë§¤í•‘ <br> (ì˜ˆ: 2013â€“10â€“11)                        ||
|| TemporalType.TIME: ì‹œê°„, ë°ì´í„°ë² ì´ìŠ¤ time íƒ€ì…ê³¼ ë§¤í•‘ <br> (ì˜ˆ: 11:11:11)                          ||
|| TemporalType.TIMESTAMP: ë‚ ì§œì™€ ì‹œê°„, ë°ì´í„°ë² ì´ìŠ¤ timestamp íƒ€ì…ê³¼ ë§¤í•‘ <br> (ì˜ˆ: 2013â€“10â€“11 11:11:11) ||

```java
@Temporal(TemporalType.TIMESTAMP)   // ë‚ ì§œ,ì‹œê°„ ëª¨ë‘ í¬í•¨
private Date createdDate;

@Temporal(TemporalType.TIMESTAMP)
private Date lastModifiedDate;
```

- í…Œì´ë¸” ìƒì„±
  ```
  createdDate timestamp(6),
  lastModifiedDate timestamp(6)
  ```

- âš ï¸ ì°¸ê³ : LocalDate, LocalDateTimeì„ ì‚¬ìš©í•  ë•ŒëŠ” ìƒëµ ê°€ëŠ¥
  (ìµœì‹  í•˜ì´ë²„ë„¤ì´íŠ¸ ì§€ì›)
- LocalDate, LocalDateTime í•„ë“œìƒì„±
```
private LocalDate testLocalDate;
private LocalDateTime testLocalDateTime;
```
- í…Œì´ë¸” ìƒì„±

    ```
    testLocalDate date,
    testLocalDateTime timestamp(6)
    ```

  - @Temporal ì–´ë…¸í…Œì´ì…˜ì„ ì§€ì •í•˜ì§€ ì•Šì•„ë„ íƒ€ì…ì´ ì •í•´ì§

### @Lob

- ë°ì´í„°ë² ì´ìŠ¤ BLOB, CLOB íƒ€ì…ê³¼ ë§¤í•‘
- @Lobì—ëŠ” ì§€ì •í•  ìˆ˜ ìˆëŠ” ì†ì„±ì´ ì—†ë‹¤
- ë§¤í•‘í•˜ëŠ” í•„ë“œ íƒ€ì…ì´ ë¬¸ìë©´ CLOB ë§¤í•‘, ë‚˜ë¨¸ì§€ëŠ” BLOB ë§¤í•‘
  - CLOB: String, char[], java.sql.CLOB
  - BLOB: byte[], java.sql.BLOB

```
@Lob    // DBì— í° ì»¨í…ì¸ ë¥¼ ë„£ê³  ì‹¶ì„ ë•Œ
private String description;
```

- í…Œì´ë¸” ìƒì„±

    ```
    description clob
    ```

  - Stringì´ë¯€ë¡œ clobíƒ€ì…ìœ¼ë¡œ ìƒì„±ë¨

### @Transient

- í•„ë“œ ë§¤í•‘X
- ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥X, ì¡°íšŒX
- ì£¼ë¡œ ë©”ëª¨ë¦¬ìƒì—ì„œë§Œ ì„ì‹œë¡œ ì–´ë–¤ ê°’ì„ ë³´ê´€í•˜ê³  ì‹¶ì„ ë•Œ ì‚¬ìš©

<br>