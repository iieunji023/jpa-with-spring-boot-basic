## ë‹¨ë°©í–¥ ì—°ê´€ê´€ê³„

```
ğŸ’¡ì˜ˆì œ ì‹œë‚˜ë¦¬ì˜¤

- íšŒì›ê³¼ íŒ€ì´ ìˆë‹¤.
- íšŒì›ì€ í•˜ë‚˜ì˜ íŒ€ì—ë§Œ ì†Œì†ë  ìˆ˜ ìˆë‹¤.
- íšŒì›ê³¼ íŒ€ì€ ë‹¤ëŒ€ì¼ ê´€ê³„ë‹¤.
```

âœ’ï¸ ë“¤ì–´ê°€ê¸° ì•ì„œ ê°ì²´ë¥¼ í…Œì´ë¸”ì— ë§ì¶° ëª¨ë¸ë§ í–ˆì„ ë•Œì˜ ë¬¸ì œì ì„ ì•Œì•„ë³´ì!

### ê°ì²´ë¥¼ í…Œì´ë¸”ì— ë§ì¶”ì–´ ëª¨ë¸ë§

ğŸ”‘ ì—°ê´€ê´€ê³„ê°€ ì—†ëŠ” ê°ì²´

<img src="https://github.com/iieunji023/jpa-with-spring-boot-basic/blob/main/images/ë‹¨ë°©í–¥1.png" width="350">

ğŸ”‘ ì°¸ì¡° ëŒ€ì‹ ì— ì™¸ë˜ í‚¤ ê·¸ëŒ€ë¡œ ì‚¬ìš©
> ì—”í‹°í‹° ìƒì„±

<details>
      <summary>Member.java</summary>

    @Entity

    public class Member {

    @Id @GeneratedValue
    @Column(name="MEMBER_ID")
    private Long id;

    @Column(name = "USERNAME")
    private String name;

    @Column(name="TEAM_ID")
    private Long  teamId;

    }

</details>

<details>
      <summary>Team.java</summary>

    @Entity
    public class Team {
    @Id
    @GeneratedValue
    @Column(name="TEAM_ID")
    private Long id;
    private String name;
    }

</details>

> í…Œì´ë¸” ìƒì„±

```
Hibernate: 
    create table Member (
        MEMBER_ID bigint not null,
        TEAM_ID bigint,
        USERNAME varchar(255),
        primary key (MEMBER_ID)
)
Hibernate: 
    create table Team (
        TEAM_ID bigint not null,
        name varchar(255),
        primary key (TEAM_ID)
)
```

ğŸ”‘  **ì™¸ë˜ í‚¤ ì‹ë³„ìë¥¼ ì§ì ‘ ë‹¤ë£¸**

> íŒ€ê³¼ íšŒì› ì €ì¥
```
Team team = new Team();

team.setName("TeamA");
em.persist(team);

Member member = new Member();
member.setUsername("member1");
member.setTeamId(team.getId());
em.persist(member);

tx.commit();
```

- `member.setTeamId(team.getId());`
    - ê°ì²´ì§€í–¥ìŠ¤ëŸ½ì§€ ì•ŠìŒ -_-..
    - `member.setTeam(~~);` ìœ¼ë¡œ í•´ì•¼ í•  ê±° ê°™ì€ë°..!

> h2 ì½˜ì†” í™•ì¸

<img src="https://github.com/iieunji023/jpa-with-spring-boot-basic/blob/main/images/ë‹¨ë°©í–¥2.png" width="200">

ğŸ”‘ ì‹ë³„ìë¡œ ë‹¤ì‹œ ì¡°íšŒ, ê°ì²´ ì§€í–¥ì ì¸ ë°©ë²•ì€ ì•„ë‹ˆë‹¤.
```
Member findMember = em.find(Member.class, member.getId());
Long findTeamId = findMember.getTeamId();
Team findTeam = em.find(Team.class, findTeamId);
```
- find()ë¥¼ í†µí•´ ê³„ì† ê°’ì„ ì°¾ì•„ì•¼ í•¨ğŸ˜‚

ğŸ’¡ ê²°ë¡ : ê°ì²´ë¥¼ í…Œì´ë¸”ì— ë§ì¶”ì–´ ë°ì´í„° ì¤‘ì‹¬ìœ¼ë¡œ ëª¨ë¸ë§í•˜ë©´, í˜‘ë ¥ê´€ê³„ë¥¼ ë§Œë“¤ ìˆ˜ ì—†ë‹¤.

- **í…Œì´ë¸”ì€ ì™¸ë˜ í‚¤ë¡œ ì¡°ì¸**ì„ ì‚¬ìš©í•´ì„œ ì—°ê´€ëœ í…Œì´ë¸”ì„ ì°¾ëŠ”ë‹¤.
- **ê°ì²´ëŠ” ì°¸ì¡°**ë¥¼ ì‚¬ìš©í•´ì„œ ì—°ê´€ëœ ê°ì²´ë¥¼ ì°¾ëŠ”ë‹¤.
- í…Œì´ë¸”ê³¼ ê°ì²´ ì‚¬ì´ì—ëŠ” ì´ëŸ° í° ê°„ê²©ì´ ìˆë‹¤.

ë¬¸ì œì ì„ ì•Œì•„ë´¤ìœ¼ë‹ˆ ì´ëŸ° ë¬¸ì œë¥¼ í•´ì†Œí•  ìˆ˜ ìˆëŠ” ë°©ë²•ë“¤ì„ ì•Œì•„ë³´ì

## ë‹¨ë°©í–¥ ì—°ê´€ê´€ê³„

### ê°ì²´ ì§€í–¥ ëª¨ë¸ë§
ğŸ”‘ ê°ì²´ ì—°ê´€ê´€ê³„ ì‚¬ìš©

<img src="https://github.com/iieunji023/jpa-with-spring-boot-basic/blob/main/images/ë‹¨ë°©í–¥3.png" width="350">

- TeamIdê°€ ì•„ë‹Œ Team ê°ì²´ë¥¼ ì°¸ì¡°

ğŸ”‘ **ê°ì²´ì˜ ì°¸ì¡°ì™€ í…Œì´ë¸”ì˜ ì™¸ë˜ í‚¤ë¥¼ ë§¤í•‘**

> ì—”í‹°í‹° ìˆ˜ì •

<details>
      <summary>Member.java</summary>

- ìˆ˜ì • ì „
```
@Column(name="TEAM_ID")
private Long  teamId;
```
- Teamê°ì²´ê°€ ì•„ë‹Œ ì•„ì´ë””ë¡œ ë§µí•‘
- ê°ì²´ ì§€í–¥ê³¼ ë§ì§€ ì•ŠìŒ
  
- ìˆ˜ì • í›„
```
@ManyToOne
@JoinColumn(name="TEAM_ID") 
private Team team;
```
- `@ManyToOne`
  - Memberì™€ Team ê°ì²´ì˜ ê´€ê³„ë¥¼ JPAì—ê²Œ ì•Œë ¤ì£¼ê¸°
  - 1ê°œì˜ íŒ€ì— ì—¬ëŸ¬ ë©¤ë²„ê°€ ìˆìœ¼ë‹ˆê¹Œ íŒ€ì´ 1, ë©¤ë²„ê°€ N
- `@JoinColumn(name="TEAM_ID")`
  - í…Œì´ë¸” ì—°ê´€ê´€ê³„ì˜ FKì™€ ì—°ê²°ì‹œì¼œì£¼ê¸°

</details>

ğŸ”‘ **ì—°ê´€ê´€ê³„ ì €ì¥ ë° ì°¸ì¡°í˜¸ ì—°ê´€ê´€ê³„ ì¡°íšŒ**

> í…Œì´ë¸”ì— ê°’ ë“±ë¡, ì¡°íšŒ

<details>
      <summary>JpaMain.java</summary>

```
// ì €ì¥
Team team = new Team();
team.setName("TeamA");
em.persist(team);

Member member = new Member();
member.setUsername("member1");
member.setTeam(team);
em.persist(member);

// ì¡°íšŒ
Member findMember = em.find(Member.class, member.getId());
Team findTeam = findMember.getTeam();
System.out.println("findTeam.getName() = " + findTeam.getName());

tx.commit();
```

- ì¶œë ¥ ê²°ê³¼
  ```
  findTeam.getName() = TeamA
  Hibernate:
    /* insert for
    hellojpa.Team */insert
    into
    Team (name, TEAM_ID)
    values
    (?, ?)
  Hibernate:
    /* insert for
    hellojpa.Member */insert
    into
    Member (TEAM_ID, USERNAME, MEMBER_ID)
    values
    (?, ?, ?)
  ```

  - Team ê°ì²´ì˜ name í•„ë“œë¥¼ ë°”ë¡œ êº¼ë‚¼ ìˆ˜ ìˆìŒ!
- ğŸ’¡ë‹¤ì‹œ í•œë²ˆ ë³µìŠµ!
  - JPAëŠ” commití•  ë•Œ INSERT SQLë¬¸ì„ DBì— ë‚ ë¦°ë‹¤ê³  í–ˆëŠ”ë° INSERT ì „ì— Teamì˜ ê°’ì´ ì¶œë ¥ë˜ëŠ” ì´ìœ ëŠ”â“
    - `@GeneratedValue` ë¥¼ ì‚¬ìš©í•˜ê²Œ ë˜ë©´ JPAì—ì„œ í•´ë‹¹ í…Œì´ë¸”ì˜ ì»¬ëŸ¼ì— ê°’ì„ ìë™ìœ¼ë¡œ ì¶”ê°€í•´ì¤€ë‹¤ê³  í–ˆëŠ”ë° ì´ëŠ” persist()ì—ì„œ ì§„í–‰ë¨!
    - ë”°ë¼ì„œ INSERT ì „ì— `@GeneratedValue` ëŠ” DBì— ë“¤ì–´ê°€ê¸° ë•Œë¬¸ì— ê°’ì„ ì¡°íšŒí•  ìˆ˜ ìˆë‹¤!
  - DBë‘ ì‹±í¬ë¥¼ ì™„ì „íˆ ë§ì¶”ê³  ì‹¶ë‹¤ë©´ `em.flush()`, `em.clean()`ì„ í†µí•´ ì˜ì†ì„±ì„ ì™„ì „íˆ ëŠê²Œ ë˜ë©°, DBì— ì¿¼ë¦¬ê°€ ë°”ë¡œ ë‚ ë¼ê°!
    ```
    Hibernate: 
    /* insert for
        hellojpa.Team */insert 
    into
        Team (name, TEAM_ID) 
    values
        (?, ?) 
    Hibernate:
    /* insert for
    hellojpa.Member */insert
    into
    Member (TEAM_ID, USERNAME, MEMBER_ID)
    values
    (?, ?, ?)
    Hibernate:
    select 
    m1_0.MEMBER_ID,
    t1_0.TEAM_ID,
    t1_0.name,
    m1_0.USERNAME
    from
    Member m1_0
    left join
    Team t1_0
    on t1_0.TEAM_ID=m1_0.TEAM_ID
    where
    m1_0.MEMBER_ID=?
    findTeam.getName() = TeamA
    ```
    - INSERT ì´í›„ ì¡°íšŒ

</details>

ğŸ”‘ ORM ë§¤í•‘

<img src="https://github.com/iieunji023/jpa-with-spring-boot-basic/blob/main/images/ë‹¨ë°©í–¥4.png" width="350">

ğŸ”‘ **ì—°ê´€ê´€ê³„ ìˆ˜ì •**

- TeamAë¥¼  TeamBë¡œ ë³€ê²½í•˜ê³  ì‹¶ì„ ë•Œ
- JpaMain.java

    ```
    Team newTeam = em.find(Team.class, 100L);
    findMember.setTeam(newTeam);
    ```

  - Team í…Œì´ë¸”ì˜ Idê°€ 100ì¸ íŒ€ìœ¼ë¡œ ë°”ê¾¸ê³  ì‹¶ë‹¤ë©´ ìœ„ ì½”ë“œì²˜ëŸ¼ë§Œ í•´ì£¼ë©´ ëœë‹¤

<br>

## ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„ì™€ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ 1 - ê¸°ë³¸

### ì–‘ë°©í–¥ ë§¤í•‘

<img src="https://github.com/iieunji023/jpa-with-spring-boot-basic/blob/main/images/ì–‘ë°©í–¥1.png" width="350">

- Memberì—ì„œëŠ” Team ê°ì²´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë‹¤
- ë°˜ëŒ€ë¡œ Teamì— Member ê°ì²´ë¥¼ ê°€ì ¸ì˜¤ê³  ì‹¶ë‹¤ë©´?
- Team ê°ì²´ì— `List members` í•„ë“œë¥¼ ìƒì„±í•´ì„œ member ê°ì²´ì— ì ‘ê·¼í•  ìˆ˜ ìˆë„ë¡ ë§Œë“¤ì–´ì¤˜ì•¼ í•œë‹¤
- í…Œì´ë¸”ì€ TEAM_ID ì™¸ë˜í‚¤ë¥¼ í†µí•´ MEMBERì™€ TEAM í…Œì´ë¸” ëª¨ë‘ ë³¼ ìˆ˜ ìˆë‹¤(ê°ì²´ ì°¸ì¡°ì™€ í…Œì´ë¸”ì˜ ì°¨ì´ì )

ğŸ”‘ **Member ì—”í‹°í‹°ëŠ” ë‹¨ë°©í–¥ê³¼ ë™ì¼**
> ì—”í‹°í‹° ìƒì„±

<details>
      <summary>Team.java</summary>

```
@Entity
public class Team {
    @Id
    @GeneratedValue
    @Column(name="TEAM_ID")
    private Long id;
    private String name;
    @OneToMany(mappedBy = "team")
    private List<Member> members = new ArrayList<Member>();

    public Long getId() {
        return id;
    }

    public void setId(Long id) {
        this.id = id;
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }
}

```

- `List<Member> members` í•„ë“œ ì¶”ê°€
- `@OneToMany`
  - íŒ€ì´ 1, ë©¤ë²„ê°€ N
- mappedBy = "team"
  - Member ì—”í‹°í‹°ì˜ teamê³¼ ì—°ê²°ë˜ì–´ ìˆë‹¤ëŠ” ì˜ë¯¸ (ì—¬ê¸°ì„œ teamì€ ë³€ìˆ˜ëª…)

</details>

**ğŸ”‘ ë°˜ëŒ€ ë°©í–¥ìœ¼ë¡œ ê°ì²´ ê·¸ë˜í”„ íƒìƒ‰**

> Team ê°ì²´ë¥¼ í†µí•´ Member ê°ì²´ ì¡°íšŒ

<details>
      <summary>JpaMain.java</summary>

```
// ì €ì¥
Team team = new Team();
team.setName("TeamA");
em.persist(team);

Member member = new Member();
member.setUsername("member1");
member.setTeam(team);
em.persist(member);

em.flush();
em.clear();

// ì¡°íšŒ
Member findMember = em.find(Member.class, member.getId());
List<Member> members = findMember.getTeam().getMembers();

for (Member m : members) {
System.out.println("m.getUsername() = " + m.getUsername());
}

tx.commit();

```

- ì¶œë ¥ ê²°ê³¼
  ```
  Hibernate: 
    /* insert for
        hellojpa.Team */insert 
    into
        Team (name, TEAM_ID) 
    values
        (?, ?)
  Hibernate:
    /* insert for
    hellojpa.Member */insert
    into
    Member (TEAM_ID, USERNAME, MEMBER_ID)
    values
    (?, ?, ?)
  Hibernate:
    select
    m1_0.MEMBER_ID,
    t1_0.TEAM_ID,
    t1_0.name,
    m1_0.USERNAME
    from
    Member m1_0
    left join
    Team t1_0
    on t1_0.TEAM_ID=m1_0.TEAM_ID
    where
    m1_0.MEMBER_ID=?
  Hibernate:
    select
    m1_0.TEAM_ID,
    m1_0.MEMBER_ID,
    m1_0.USERNAME
    from
    Member m1_0
    where
    m1_0.TEAM_ID=?
    m.getUsername() = member1
  ```
  - member ê°ì²´ì˜ usernameì„ ê°€ì ¸ì˜´

</details>

### ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ê³¼ mappedBy

```jsx
@Entity
public class Team {
	@OneToMany(mappedBy = "team")
	private List<Member> members = new ArrayList<Member>();
}
```

- mappedBy - JPAì˜ ë©˜íƒˆë¶•ê´´ ë‚œì˜ë„
- mappedByëŠ” ì²˜ìŒì—ëŠ” ì´í•´í•˜ê¸° ì–´ë µë‹¤.
- ê°ì²´ì™€ í…Œì´ë¸” ê°„ì— ì—°ê´€ê´€ê³„ë¥¼ ë§ºëŠ” ì°¨ì´ë¥¼ ì´í•´í•´ì•¼ í•œë‹¤.

### ê°ì²´ì™€ í…Œì´ë¸”ì´ ê´€ê³„ë¥¼ ë§ºëŠ” ì°¨ì´

- **ê°ì²´ ì—°ê´€ê´€ê³„ = 2ê°œ**
  - íšŒì› â†’ íŒ€ ì—°ê´€ê´€ê³„ 1ê°œ (ë‹¨ë°©í–¥)
  - íŒ€ â†’ íšŒì› ì—°ê´€ê´€ê³„ 1ê°œ (ë‹¨ë°©í–¥)
- **í…Œì´ë¸” ì—°ê´€ê´€ê³„ = 1ê°œ**
  - íšŒì› â†” íŒ€ì˜ ì—°ê´€ê´€ê³„ 1ê°œ(ì–‘ë°©í–¥)

### ê°ì²´ì˜ ì–‘ë°©í–¥ ê´€ê³„

- ê°ì²´ì˜ **ì–‘ë°©í–¥ ê´€ê³„ëŠ” ì‚¬ì‹¤ ì–‘ë°©í–¥ ê´€ê³„ê°€ ì•„ë‹ˆë¼ ì„œë¡œ ë‹¤ë¥¸ ë‹¨ë°©í–¥ ê´€ê³„ 2ê°œ**ë‹¤.
- ê°ì²´ë¥¼ ì–‘ë°©í–¥ìœ¼ë¡œ ì°¸ì¡°í•˜ë ¤ë©´ **ë‹¨ë°©í–¥ ì—°ê´€ê´€ê³„ë¥¼ 2ê°œ ë§Œë“¤ì–´ì•¼ í•œë‹¤.**

### í…Œì´ë¸”ì˜ ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„

- í…Œì´ë¸”ì€ ì™¸ë˜ í‚¤ í•˜ë‚˜ë¡œ ë‘ í…Œì´ë¸”ì˜ ì—°ê´€ê´€ê³„ë¥¼ ì •ë¦¬
- MEMBER.TEAM_ID ì™¸ë˜ í‚¤ í•˜ë‚˜ë¡œ ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„ ê°€ì§
  (ì–‘ìª½ìœ¼ë¡œ ì¡°ì¸í•  ìˆ˜ ìˆë‹¤.)

```sql
SELECT *
FROM MEMBER M
JOIN TEAM T ON M.TEAM_ID = T.TEAM_ID
```

```sql
SELECT *
FROM TEAM T
JOIN MEMBER M ON T.TEAM_ID = M.TEAM_ID
```

### ë‘˜ ì¤‘ í•˜ë‚˜ë¡œ ì™¸ë˜ í‚¤ë¥¼ ê´€ë¦¬í•´ì•¼ í•œë‹¤.

<img src="https://github.com/iieunji023/jpa-with-spring-boot-basic/blob/main/images/ì–‘ë°©í–¥2.png" width="350">

### ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸(Owner)

> ì–‘ë°©í–¥ ë§¤í•‘ ê·œì¹™
>
- ê°ì²´ì˜ ë‘ ê´€ê³„ ì¤‘ í•˜ë‚˜ë¥¼ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ìœ¼ë¡œ ì§€ì •
- **ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ë§Œì´ ì™¸ë˜ í‚¤ë¥¼ ê´€ë¦¬(ë“±ë¡, ìˆ˜ì •)**
- **ì£¼ì¸ì´ ì•„ë‹Œ ìª½ì€ ì½ê¸°ë§Œ ê°€ëŠ¥**
- ì£¼ì¸ì€ mappedBy ì†ì„± ì‚¬ìš©X
- ì£¼ì¸ì´ ì•„ë‹ˆë©´ mappedBy ì†ì„±ìœ¼ë¡œ ì£¼ì¸ ì§€ì •

### ëˆ„êµ¬ë¥¼ ì£¼ì¸ìœ¼ë¡œ?

- ì™¸ë˜ í‚¤ê°€ ìˆëŠ” ê³³ì„ ì£¼ì¸ìœ¼ë¡œ ì •í•´ë¼
- ì—¬ê¸°ì„œëŠ” **Member.team**ì´ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸

<img src="https://github.com/iieunji023/jpa-with-spring-boot-basic/blob/main/images/ì–‘ë°©í–¥3.png" width="350">

- DBëŠ” ì™¸ë˜í‚¤(FK)ê°€ ìˆëŠ” ê³³ì´ ë¬´ì¡°ê±´ N, ì™¸ë˜í‚¤ê°€ ì—†ëŠ” ê³³ì€ 1
- ê·¸ë§ì€ ì¦‰, 1:N ì¤‘ N ìª½ì´ ë¬´ì¡°ê±´ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì´ ëœë‹¤!

<br>

## ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„ì™€ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ 2 - ì£¼ì˜ì , ì •ë¦¬

### ì–‘ë°©í–¥ ë§¤í•‘ì‹œ ê°€ì¥ ë§ì´ í•˜ëŠ” ì‹¤ìˆ˜

**ğŸ”‘ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì— ê°’ì„ ì…ë ¥í•˜ì§€ ì•ŠìŒ**

> ğŸ˜£ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì¸ Memberê°€ ì•„ë‹Œ Teamì—ì„œ ê°’ ë“±ë¡ğŸ˜£

<details>
      <summary>JpaMain.java</summary>

```
// ì €ì¥
Member member = new Member();
member.setUsername("member1");
em.persist(member);

Team team = new Team();
team.setName("teamA");
team.getMembers().add(member);
em.persist(team);

em.flush();
em.clear();

tx.commit();
```

</details>

> h2 ì½˜ì†” í™•ì¸

<img src="https://github.com/iieunji023/jpa-with-spring-boot-basic/blob/main/images/h2ê²°ê³¼2.png" width="200">

- MEMBER í…Œì´ë¸”ì— TEAM_ID ì»¬ëŸ¼(ì™¸ë˜í‚¤ ê°’)ì´ null
- why â“
  - ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì´ ì•„ë‹ˆë©´ ì¡°íšŒë§Œ í•œë‹¤
  - JPAê°€ insertë¥¼ ê³ ë ¤í•˜ì§€ ì•ŠëŠ”ë‹¤
  - ë”°ë¼ì„œ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì¸ Memberë¥¼ í†µí•´ ê°’ì„ ë“±ë¡í•´ì¤˜ì•¼ í•œë‹¤!

> ğŸ˜„ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì¸ Memberë¥¼ í†µí•´ ê°’ ë“±ë¡ ğŸ˜„

<details>
      <summary>JpaMain.java</summary>

```
// ì €ì¥
Team team = new Team();
team.setName("teamA");
em.persist(team);

Member member = new Member();
member.setUsername("member1");
member.setTeam(team);
em.persist(member);

em.flush();
em.clear();

tx.commit();
```

- ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì¸ member ê°ì²´ë¥¼ í†µí•´ team ê°’ ë“±ë¡

</details>

> h2 ì½˜ì†” í™•ì¸

<img src="https://github.com/iieunji023/jpa-with-spring-boot-basic/blob/main/images/h2ê²°ê³¼3.png" width="200">

- TEAM_IDì— ì •ìƒì ìœ¼ë¡œ ê°’ì´ ë“±ë¡ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤

### ì–‘ë°©í–¥ ë§¤í•‘ì‹œ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì— ê°’ì„ ì…ë ¥í•´ì•¼ í•œë‹¤

ğŸ”‘ **ìˆœìˆ˜í•œ ê°ì²´ ê´€ê³„ë¥¼ ê³ ë ¤í•˜ë©´ í•­ìƒ ì–‘ìª½ ë‹¤ ê°’ì„ ì…ë ¥í•´ì•¼ í•œë‹¤.**

ğŸ’¡ ê·¸ëŸ¬ë‚˜ ê°ì²´ì§€í–¥ì˜ ê´€ì ì—ì„œ ë³´ë©´ Member ê°ì²´ì™€ Team ê°ì²´ ë‘ ê³³ ëª¨ë‘ ê°’ì„ ë“±ë¡í•´ì¤˜ì•¼ í•œë‹¤ â€¼ï¸

```
// ì €ì¥
Team team = new Team();
team.setName("teamA");
em.persist(team);

Member member = new Member();
member.setUsername("member1");
member.setTeam(team);
em.persist(member);

em.flush();
em.clear();

Team findTeam = em.find(Team.class, team.getId());  // 1ì°¨ ìºì‹œ
List<Member> members = findTeam.getMembers();

for (Member m : members) {
     System.out.println("m = " + m.getUsername());
}

tx.commit();
```

- `em.flush()`, `em.clear()`ê°€ ìˆì„ ë•ŒëŠ” ì˜ì†ì„±ì„ ëŠìœ¼ë©´ì„œ DBì— ë°”ë¡œ INSERT ë˜ê¸° ë•Œë¬¸ì— Team ê°ì²´ì— ê°’ì„ ë“±ë¡í•´ì£¼ì§€ ì•Šì•„ë„ Team ê°ì²´ ë‚´ì˜ í•„ë“œë“¤ì„ ì¡°íšŒí•  ìˆ˜ ìˆë‹¤.
- ê·¸ëŸ¬ë‚˜ `em.flush()`, `em.clear()`ë¥¼ ì£¼ì„í•˜ê³  ëŒë ¤ë³´ë©´ Team ê°ì²´ê°€ ì¡°íšŒë˜ì§€ ì•ŠëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤

<details>
      <summary>ì¶œë ¥ê²°ê³¼</summary>

```
Hibernate: 
    create table Member (
        MEMBER_ID bigint not null,
        TEAM_ID bigint,
        USERNAME varchar(255),
        primary key (MEMBER_ID)
    )
Hibernate: 
    create table Team (
        TEAM_ID bigint not null,
        name varchar(255),
        primary key (TEAM_ID)
    )
Hibernate: 
    alter table if exists Member 
       add constraint FKl7wsny760hjy6x19kqnduasbm 
       foreign key (TEAM_ID) 
       references Team
Hibernate: 
    select
        next value for Team_SEQ
Hibernate: 
    select
        next value for Member_SEQ
Hibernate: 
    /* insert for
        hellojpa.Team */insert 
    into
        Team (name, TEAM_ID) 
    values
        (?, ?)
Hibernate: 
    /* insert for
        hellojpa.Member */insert 
    into
        Member (TEAM_ID, USERNAME, MEMBER_ID) 
    values
        (?, ?, ?)
```

</details>

> Team ê°ì²´ì— ê°’ ë“±ë¡

<details>
      <summary>JpaMain.java</summary>

```
// ì €ì¥
Team team = new Team();
team.setName("teamA");
em.persist(team);

Member member = new Member();
member.setUsername("member1");
member.setTeam(team);
em.persist(member);

team.getMembers().add(member);

Team findTeam = em.find(Team.class, team.getId());  // 1ì°¨ ìºì‹œ
List<Member> members = findTeam.getMembers();       // ì»¬ë ‰ì…˜ì— ì•„ë¬´ê²ƒë„ ì¡´ì¬í•˜ì§€ ì•ŠìŒ, ìˆœìˆ˜í•œ ê°ì²´ ìƒíƒœ

System.out.println("=======================");
for (Member m : members) {
   System.out.println("m = " + m.getUsername());
}
System.out.println("=======================");

tx.commit();
```

- ì¶œë ¥ê²°ê³¼
  ```
  =======================
  m = member1
  =======================
  ```
  - em.flush(), em.clear() í•˜ì§€ ì•Šì•„ë„ team ê°ì²´ ê°’ ì¡°íšŒë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŒ!

</details>

### ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„ ì£¼ì˜ - ì‹¤ìŠµ

- ìˆœìˆ˜ ê°ì²´ ìƒíƒœë¥¼ ê³ ë ¤í•´ì„œ í•­ìƒ ì–‘ìª½ì— ê°’ì„ ì„¤ì •í•˜ì
- ì—°ê´€ê´€ê³„ í¸ì˜ ë©”ì†Œë“œë¥¼ ìƒì„±í•˜ì
- ì–‘ë°©í–¥ ë§¤í•‘ì‹œì— ë¬´í•œ ë£¨í”„ë¥¼ ì¡°ì‹¬í•˜ì
  - ì˜ˆ) toString(), lombok, JSON ìƒì„± ë¼ì´ë¸ŒëŸ¬ë¦¬

**ğŸ”‘ ì—°ê´€ê´€ê³„ í¸ì˜ ë©”ì†Œë“œë¥¼ ìƒì„±í•˜ì**

- ë§¤ë²ˆ `member.setTeam(team);` ë„ í•´ì£¼ê³ , `team.getMembers().add(member);` ë„ í•´ì£¼ì–´ì•¼ í•˜ëŠ”ë° ê¹Œë¨¹ì„ ìˆ˜ë„ ìˆê³ , ë²ˆê±°ë¡­ê¸°ë„ í•˜ë‹¤ â‡’ ì—°ê´€ê´€ê³„ í¸ì˜ ë©”ì†Œë“œë¥¼ ìƒì„±í•˜ì!

> Memberê°ì²´ì˜ set ë©”ì†Œë“œì—ì„œ ê°’ ë“±ë¡í•´ì£¼ê¸°

<details>
      <summary>Member.java</summary>

```
@Entity
public class Member {
public void setTeam(Team team) {
        this.team = team;
        team.getMembers().add(this);    
    }
}
```
- setTeamì— `team.getMembers().add(this);` ì¶”ê°€í•´ì¤€ë‹¤
- ì—¬ê¸°ì„œ thisëŠ” í˜„ì¬ ë‚˜ ìì‹ ì´ë‹¤. (Member)

</details>

> Main ë©”ì†Œë“œì—ì„œ Team ê°ì²´ì— ê°’ ë“±ë¡í•˜ëŠ” ë¶€ë¶„ ì‚­ì œ

<details>
      <summary>JpaMain.java</summary>

```
// ì €ì¥
Team team = new Team();
team.setName("teamA");
em.persist(team);

Member member = new Member();
member.setUsername("member1");
member.setTeam(team);
em.persist(member);

//team.getMembers().add(member);

em.flush();
em.clear();

Team findTeam = em.find(Team.class, team.getId());  // 1ì°¨ ìºì‹œ
List<Member> members = findTeam.getMembers();       // ì»¬ë ‰ì…˜ì— ì•„ë¬´ê²ƒë„ ì¡´ì¬í•˜ì§€ ì•ŠìŒ, ìˆœìˆ˜í•œ ê°ì²´ ìƒíƒœ

System.out.println("=======================");
for (Member m : members) {
   System.out.println("m = " + m.getUsername());
}
System.out.println("=======================");

tx.commit();
```

</details>

ğŸ’¡ ì°¸ê³ : ë‹¨ìˆœíˆ setí•˜ëŠ” ê²Œ ì•„ë‹ˆë¼ ì´ëŸ¬í•œ íŠ¹ìˆ˜í•œ ê²½ìš°ì—ëŠ” ë©”ì„œë“œëª…ì„ setTeam()ìœ¼ë¡œ í•˜ê¸°ë³´ë‹¤ëŠ” changeTeam()ìœ¼ë¡œ ë°”ê¿”ì£¼ëŠ” ê²ƒì´ ì¢‹ìŒ

- ë°˜ëŒ€ë¡œ Team()ì—ì„œ ê°’ ì„¸íŒ…ì„ í•´ì£¼ì–´ë„ ëœë‹¤
  (ê°œë°œì„ í•  ë•Œ Memberì—ì„œ í• ì§€, Teamì—ì„œ í• ì§€ ì •í•  ê²ƒ)
- Teamì—ì„œ í•˜ê²Œ ëœë‹¤ë©´

> Teamê°ì²´ì—ì„œ Member ê°’ì„ ì„¸íŒ…í•˜ëŠ” ë©”ì„œë“œ ìƒì„±í•˜ê¸°

<details>
      <summary>Team.java</summary>

```
public void addMember(Member member) {
    member.changeTeam(this);
    members.add(member);
}
```

</details>

> Main ë©”ì†Œë“œì—ì„œ Member ê°’ ë“±ë¡

<details>
      <summary>JpaMain.java</summary>

```
Team team = new Team();
team.setName("teamA");
em.persist(team);

Member member = new Member();
member.setUsername("member1");
member.changeTeam(team);
em.persist(member);

team.addMember(member);

tx.commit();
```

</details>

- Memberì—ì„œ ê°’ì„ ë“±ë¡í• ì§€, Teamì—ì„œ ê°’ì„ ë“±ë¡í• ì§€ ì •í•´ì„œ í•œ ê³³ì—ì„œë§Œ ê°’ì„ ì„¸íŒ…í•´ì¤˜ì•¼ í•œë‹¤.
- ì–‘ìª½ ëª¨ë‘ì—ì„œ ê°’ì„ ì„¸íŒ…í•˜ê²Œ ë˜ë©´ ë¬´í•œ ë£¨í”„ì— ê±¸ë¦´ ìœ„í—˜ì´ ìˆë‹¤

**ğŸ”‘ ì–‘ë°©í–¥ ë§¤í•‘ì‹œì— ë¬´í•œ ë£¨í”„ë¥¼ ì¡°ì‹¬í•˜ì**

- ë§Œì•½ toString()ì„ í˜¸ì¶œí•œë‹¤ê³  ê°€ì •í•´ë³´ì

<details>
      <summary>Member.java</summary>

```
@Override
public String toString() {
        return "Member{" +
                "id=" + id +
                ", username='" + username + '\'' +
                ", team=" + team +
                '}';
}
```
- teamì˜ toString()ë„ í˜¸ì¶œí•¨

</details>

<details>
      <summary>Team.java</summary>

```
@Override
public String toString() {
        return "Team{" +
                "id=" + id +
                ", name='" + name + '\'' +
                ", members=" + members +
                '}';
}
```
- members ì»¬ë ‰ì…˜ì„ ëŒë©´ì„œ toStringì„ í˜¸ì¶œí•¨

</details>

- ì´ë ‡ê²Œ ë˜ë©´ ì–‘ìª½ìœ¼ë¡œ ë¬´í•œ toString()ì„ í˜¸ì¶œí•˜ê²Œ ëœë‹¤.

> Team ê°ì²´ì˜ toString() ì¶œë ¥

<details>
      <summary>JpaMain.java</summary>

```
Team team = new Team();
team.setName("teamA");
em.persist(team);

Member member = new Member();
member.setUsername("member1");
em.persist(member);

team.addMember(member);

em.flush();
em.clear();

Team findTeam = em.find(Team.class, team.getId());  // 1ì°¨ ìºì‹œ
List<Member> members = findTeam.getMembers();       // ì»¬ë ‰ì…˜ì— ì•„ë¬´ê²ƒë„ ì¡´ì¬í•˜ì§€ ì•ŠìŒ, ìˆœìˆ˜í•œ ê°ì²´ ìƒíƒœ

System.out.println("=======================");
System.out.println("members = " + findTeam);
System.out.println("=======================");

tx.commit();
```

</details>

```
Exception in thread "main" java.lang.StackOverflowError
```
- `StackOverflowError` ë°œìƒ

ğŸ’¡ Lombokì—ì„œ toString()ì€ ì›¬ë§Œí•˜ë©´ ë§Œë“¤ì§€ë§ê¸°!!

### ì–‘ë°©í–¥ ë§¤í•‘ ì •ë¦¬

- ë‹¨ë°©í–¥ ë§¤í•‘ë§Œìœ¼ë¡œë„ ì´ë¯¸ ì—°ê´€ê´€ê³„ ë§¤í•‘ì€ ì™„ë£Œ
- ì–‘ë°©í–¥ ë§¤í•‘ì€ ë°˜ëŒ€ ë°©í–¥ìœ¼ë¡œ ì¡°íšŒ(ê°ì²´ ê·¸ë˜í”„ íƒìƒ‰) ê¸°ëŠ¥ì´ ì¶”ê°€ëœ ê²ƒë¿
- JPQLì—ì„œ ì—­ë°©í–¥ìœ¼ë¡œ íƒìƒ‰í•  ì¼ì´ ë§ìŒ
- ë‹¨ë°©í–¥ ë§¤í•‘ì„ ì˜ í•˜ê³  ì–‘ë°©í–¥ì€ í•„ìš”í•  ë•Œ ì¶”ê°€í•´ë„ ë¨
  (í…Œì´ë¸”ì— ì˜í–¥ì„ ì£¼ì§€ ì•ŠìŒ)

### ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì„ ì •í•˜ëŠ” ê¸°ì¤€

- ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ê¸°ì¤€ìœ¼ë¡œ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì„ ì„ íƒí•˜ë©´ ì•ˆë¨
- **ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì€ ì™¸ë˜ í‚¤ì˜ ìœ„ì¹˜ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì •í•´ì•¼ í•¨**
  - ì™¸ë˜í‚¤ê°€ ìˆëŠ” ìª½ì´ ì£¼ì¸!
  - ë§Œì•½ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì¸ ì•„ë‹Œ ê°ì²´ì— ê°’ì„ ë„£ê³  ì‹¶ë‹¤ë©´ ì—°ê´€ê´€ê³„ í¸ì˜ ë©”ì„œë“œë¥¼ í™œìš©í•˜ë©´ ë¨!

<br>
