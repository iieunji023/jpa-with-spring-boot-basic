## ê°ì²´ì™€ í…Œì´ë¸” ë§¤í•‘

### ì—”í‹°í‹° ë§¤í•‘ ì†Œê°œ

- ê°ì²´ì™€ í…Œì´ë¸” ë§¤í•‘: `@Entity`, `@Table`
- í•„ë“œì™€ ì»¬ëŸ¼ ë§¤í•‘: `@Column`
- ê¸°ë³¸ í‚¤ ë§¤í•‘: `@Id`
- ì—°ê´€ê´€ê³„ ë§¤í•‘: `@ManyToOne`, `@JoinColumn`

> **@Entity**

- `@Entity` ê°€ ë¶™ì€ í´ë˜ìŠ¤ëŠ” JPAê°€ ê´€ë¦¬, ì—”í‹°í‹°ë¼ í•œë‹¤.
- JPAë¥¼ ì‚¬ìš©í•´ì„œ í…Œì´ë¸”ê³¼ ë§¤í•‘í•  í´ë˜ìŠ¤ëŠ” `@Entity` í•„ìˆ˜
- âš ï¸ ì£¼ì˜
    - ê¸°ë³¸ ìƒì„±ì í•„ìˆ˜(íŒŒë¼ë¯¸í„°ê°€ ì—†ëŠ” public ë˜ëŠ” protexted ìƒì„±ì)
    - final í´ë˜ìŠ¤, enum, interface, inner í´ë˜ìŠ¤ ì‚¬ìš© X
    - ì €ì¥í•  í•„ë“œì— final ì‚¬ìš© X

> **@Entity ì†ì„± ì •ë¦¬**

- ì†ì„±: name
    - JPAì—ì„œ ì‚¬ìš©í•  ì—”í‹°í‹° ì´ë¦„ì„ ì§€ì •í•œë‹¤.
    - ê¸°ë³¸ê°’: í´ë˜ìŠ¤ ì´ë¦„ì„ ê·¸ëŒ€ë¡œ ì‚¬ìš©(ì˜ˆ: Member)
    - ê°™ì€ í´ë˜ìŠ¤ ì´ë¦„ì´ ì—†ìœ¼ë©´ ê°€ê¸‰ì  ê¸°ë³¸ê°’ì„ ì‚¬ìš©í•œë‹¤.

> **@Table**

- `@Table`ì€ ì—”í‹°í‹°ì™€ ë§¤í•‘í•  í…Œì´ë¸” ì§€ì •

  |ì†ì„±|ê¸°ëŠ¥|ê¸°ë³¸ê°’|
  |---|---|---|
  |name|ë§¤í•‘í•  í…Œì´ë¸” ì´ë¦„|ì—”í‹°í‹° ì´ë¦„ì„ ì‚¬ìš©|
  |catalog|ë°ì´í„°ë² ì´ìŠ¤ catalog ë§¤í•‘||
  |schema|ë°ì´í„°ë² ì´ìŠ¤ schema ë§¤í•‘||
  |uniqueConstraints(DDL)|DDL ìƒì„±ì‹œ ìœ ë‹ˆí¬ ì œì•½ì¡°ê±´ ìƒì„±||

<br>

## ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ìë™ ìƒì„±

- DDLì„ ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰ ì‹œì ì— ìë™ ìƒì„±
- í…Œì´ë¸” ì¤‘ì‹¬ â†’ ê°ì²´ ì¤‘ì‹¬
- ë°ì´í„°ë² ì´ìŠ¤ ë°©ì–¸ì„ í™œìš©í•´ì„œ ë°ì´í„°ë² ì´ìŠ¤ì— ë§ëŠ” ì ì ˆí•œ DDL ìƒì„±
- ì´ë ‡ê²Œ **ìƒì„±ëœ DDLì€ ê°œë°œ ì¥ë¹„ì—ì„œë§Œ ì‚¬ìš©**
- ìƒì„±ëœ DDLì€ ìš´ì˜ì„œë²„ì—ì„œëŠ” ì‚¬ìš©í•˜ì§€ ì•Šê±°ë‚˜, ì ì ˆíˆ ë‹¤ë“¬ì€ í›„ ì‚¬ìš©

### ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ìë™ ìƒì„± - ì†ì„±

- hibernate.hbm2ddl.auto

  |ì˜µì…˜|ì„¤ëª…|
    |--|---|
  |create|ê¸°ì¡´í…Œì´ë¸” ì‚­ì œ í›„ ë‹¤ì‹œ ìƒì„±(DROP + CREATE)|
  |create-drop|createì™€ ê°™ìœ¼ë‚˜ ì¢…ë£Œì‹œì ì— í…Œì´ë¸” DROP|
  |update|ë³€ê²½ë¶„ë§Œ ë°˜ì˜(ìš´ì˜ DBì—ëŠ” ì‚¬ìš©í•˜ë©´ ì•ˆë¨)|
  |validate|ì—”í‹°í‹°ì™€ í…Œì´ë¸”ì´ ì •ìƒ ë§¤í•‘ë˜ì—ˆëŠ”ì§€ë§Œ í™•ì¸|
  |none|ì‚¬ìš©í•˜ì§€ ì•ŠìŒ|

### ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ìë™ ìƒì„± - ì‹¤ìŠµ

> create

- ì¶œë ¥ ê²°ê³¼
```
Hibernate: 
    drop table if exists Member cascade 
Hibernate: 
    create table Member (
        id bigint not null,
        name varchar(10) unique,
        primary key (id)
    )

Hibernate: 
    select
        m1_0.id,
        m1_0.name 
    from
        Member m1_0 
    where
        m1_0.id=?
```
- ê¸°ì¡´ í…Œì´ë¸” ì‚­ì œ í›„ í…Œì´ë¸”ì´ ìƒì„±ë˜ëŠ” ê²ƒì„ í™•ì¸

> create-drop

- ì¶œë ¥ê²°ê³¼

```
Hibernate: 
    drop table if exists Member cascade 
Hibernate: 
    create table Member (
        id bigint not null,
        name varchar(10) unique,
        primary key (id)
    )
Hibernate: 
    select
        m1_0.id,
        m1_0.name 
    from
        Member m1_0 
    where
        m1_0.id=?
Hibernate: 
    drop table if exists Member cascade 
```

- ê¸°ì¡´ í…Œì´ë¸” ì‚­ì œ í›„ í…Œì´ë¸”ì´ ìƒì„±ë˜ëŠ” ê²ƒì€ **createì™€ ë™ì¼**
- ì„œë¹„ìŠ¤ ì¢…ë£Œ ì‹œì ì— í…Œì´ë¸”ì„ ì‚­ì œ

> update

- ì¶œë ¥ ê²°ê³¼

```
Hibernate: 
    create table Member (
        id bigint not null,
        email varchar(255),
        name varchar(10),
        primary key (id)
    )
Hibernate: 
    alter table if exists Member 
       drop constraint if exists UK_ektea7vp6e3low620iewuxhlq
Hibernate: 
    alter table if exists Member 
       add constraint UK_ektea7vp6e3low620iewuxhlq unique (name)
Hibernate: 
    select
        m1_0.id,
        m1_0.email,
        m1_0.name 
    from
        Member m1_0 
    where
        m1_0.id=?
```

- í…Œì´ë¸”ì— email ì»¬ëŸ¼ì„ ì¶”ê°€í•˜ê³  ì‹¶ì€ë° createê°€ ì•„ë‹Œ alterë¥¼ í•˜ê³  ì‹¶ì„ ë•Œ
- ì‚­ì œí•  ë•ŒëŠ” ì ìš© ì•ˆë¨(âŒâŒâŒ)

> validate

- ì¶œë ¥ ê²°ê³¼

```
Caused by: org.hibernate.tool.schema.spi.SchemaManagementException: Schema-validation: missing column [phone] in table [Member]
```

- Member ì—”í‹°í‹°ì— phone í•„ë“œë¥¼ ì¶”ê°€í•˜ê³  ëŒë ¤ë³´ë©´ ì—ëŸ¬ ë°œìƒ

### ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ìë™ ìƒì„± - ì£¼ì˜

- ìš´ì˜ ì¥ë¹„ì—ëŠ” ì ˆëŒ€ create, create-drop, updateë¥¼ ì‚¬ìš©í•˜ë©´ ì•ˆëœë‹¤.
- ê°œë°œ ì´ˆê¸° ë‹¨ê³„ëŠ” create ë˜ëŠ” update
- í…ŒìŠ¤íŠ¸ ì„œë²„ëŠ” update ë˜ëŠ” validate
- ìŠ¤í…Œì´ì§•ê³¼ ìš´ì˜ ì„œë²„ëŠ” validate ë˜ëŠ” none

### DDL ìƒì„± ê¸°ëŠ¥

- ì œì•½ì¡°ê±´ ì¶”ê°€: íšŒì› ì´ë¦„ì€ í•„ìˆ˜, 10ì ì´ˆê³¼X
    - `@Column(nullable = false, length = 10)`
- ìœ ë‹ˆí¬ ì œì•½ì¡°ê±´ ì¶”ê°€
    - `@Table(uniqueConstraints = {@UniqueConstraint( name = "NAME_AGE_UNIQUE",
    columnNames = {"NAME", "AGE"} )})`
- ì‹¤ìŠµ
    - `@Column(unique = true, length = 10)`

```
create table Member (
        id bigint not null,
        name varchar(10) unique,
        email varchar(255),
        phone varchar(255),
        primary key (id)
    )
```

- DDL ìƒì„± ê¸°ëŠ¥ì€ DDLì„ ìë™ ìƒì„±í•  ë•Œë§Œ ì‚¬ìš©ë˜ê³  JPAì˜ ì‹¤í–‰ ë¡œì§ì—ëŠ” ì˜í–¥ì„ ì£¼ì§€ ì•ŠëŠ”ë‹¤.
- JPA ì‹¤í–‰ ë§¤ì»¤ë‹ˆì¦˜ì— ì˜í–¥ì„ ì£¼ì§€ëŠ” ì•ŠìŒ
- DBì— ì˜í–¥ì„ ì£¼ëŠ” ê²ƒ

<br>

## í•„ë“œì™€ ì»¬ëŸ¼ ë§¤í•‘

```
ğŸ’¡ìš”ì²­ì‚¬í•­ ì¶”ê°€
1. íšŒì›ì€ ì¼ë°˜íšŒì›ê³¼ ê´€ë¦¬ìë¡œ êµ¬ë¶„í•´ì•¼ í•œë‹¤.
2. íšŒì› ê°€ì…ì¼ê³¼ ìˆ˜ì •ì¼ì´ ìˆì–´ì•¼ í•œë‹¤.
3. íšŒì›ì„ ì„¤ëª…í•  ìˆ˜ ìˆëŠ” í•„ë“œê°€ ìˆì–´ì•¼ í•œë‹¤. ì´ í•„ë“œëŠ” ê¸¸ì´ ì œí•œì´ ì—†ë‹¤.
```

<details>
      <summary>Member.java</summary>

    @Entity
    public class Member {

    @Id 
    private Long id;

    @Column(name = "name")  
    private String username;

    private Integer age;

    @Enumerated(EnumType.STRING)   
    private RoleType roleType;

    @Temporal(TemporalType.TIMESTAMP) 
    private Date createdDate;

    @Temporal(TemporalType.TIMESTAMP)
    private Date lastModifiedDate;

    @Lob    
    private String description;

		@Transient 
    private int temp;

    public Member() {

    }
    } 

- @Entity: JPAë¥¼ ì‚¬ìš©í•˜ëŠ” í´ë˜ìŠ¤ë¼ëŠ” ê²ƒì„ ì¸ì‹
- @Id: JPAì—ê²Œ PKê°€ ë­”ì§€ ì•Œë ¤ì¤Œ
- @Enumerated(EnumType.STRING): ê°ì²´ì—ì„œ ENUM íƒ€ì…ì„ ì“°ê³  ì‹¶ì„ ë•Œ
- @Temporal(TemporalType.TIMESTAMP): ë‚ ì§œ,ì‹œê°„ ëª¨ë‘ í¬í•¨
- @Lob: DBì— í° ì»¨í…ì¸ ë¥¼ ë„£ê³  ì‹¶ì„ ë•Œ
- @Transient: DBì— ì¶”ê°€X, ë©”ëª¨ë¦¬ì—ì„œ ì“°ê² ë‹¤ëŠ” ì˜ë¯¸

</details>

- í…Œì´ë¸” ìë™ ìƒì„±

    ```
    Hibernate: 
        create table Member (
            age integer,
            createdDate timestamp(6),
            id bigint not null,
            lastModifiedDate timestamp(6),
            name varchar(255),
            roleType varchar(255) check (roleType in ('USER','ADMIN')),
            description clob,
            primary key (id)
        )
    ```

### ë§¤í•‘ ì–´ë…¸í…Œì´ì…˜ ì •ë¦¬

|ì–´ë…¸í…Œì´ì…˜|ì„¤ëª…|
|---|--------------------------|
|@Column| ì»¬ëŸ¼ ë§¤í•‘                    |
|@Temporal| ë‚ ì§œ íƒ€ì… ë§¤í•‘                 |
|@Enumerated| enum íƒ€ì… ë§¤í•‘               |
|@Lob| BLOB, CLOB ë§¤í•‘            |
|@Transient| íŠ¹ì • í•„ë“œë¥¼ ì»¬ëŸ¼ì— ë§¤í•‘í•˜ì§€ ì•ŠìŒ(ë§¤í•‘ ë¬´ì‹œ) |

### @Column

| ì†ì„±                  | ì„¤ëª…                                                                                                                                                                 | ê¸°ë³¸ê°’                  |
|---------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------------------|
| name                | í•„ë“œì™€ ë§¤í•‘í•  í…Œì´ë¸”ì˜ ì»¬ëŸ¼ ì´ë¦„                                                                                                                                                 | ê°ì²´ì˜ í•„ë“œ ì´ë¦„            |
| insertable, updatable | ë“±ë¡, ë³€ê²½ ê°€ëŠ¥ ì—¬ë¶€                                                                                                                                                       | TRUE                 |
| nullable(DDL)             | null ê°’ì˜ í—ˆìš© ì—¬ë¶€ë¥¼ ì„¤ì •í•œë‹¤. falseë¡œ ì„¤ì •í•˜ë©´ DDL ìƒì„± ì‹œì— not null ì œì•½ì¡°ê±´ì´ ë¶™ëŠ”ë‹¤.                                                                                                     |                      |
| unique(DDL) | @Tableì˜ uniqueConstraintsì™€ ê°™ì§€ë§Œ í•œ ì»¬ëŸ¼ì— ê°„ë‹¨íˆ ìœ ë‹ˆí¬ ì œì•½ ì¡°ê±´ì„ ê±¸ ë•Œ ì‚¬ìš©í•œë‹¤.     |  |
|columnDefinition(DDL)| ë°ì´í„°ë² ì´ìŠ¤ ì»¬ëŸ¼ ì •ë³´ë¥¼ ì§ì ‘ ì¤„ ìˆ˜ ìˆë‹¤. <br> ex) varchar(100) default â€˜EMPTYâ€™|í•„ë“œì˜ ìë°” íƒ€ì…ê³¼ ë°©ì–¸ ì •ë³´ë¥¼ ì‚¬ìš© |
|length(DDL)| ë¬¸ì ê¸¸ì´ ì œì•½ì¡°ê±´, String íƒ€ì…ì—ë§Œ ì‚¬ìš©í•œë‹¤.| 255                  |
|precision,scale(DDL)| BigDecimal íƒ€ì…ì—ì„œ ì‚¬ìš©í•œë‹¤(BigIntegerë„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤).<br>precisionì€ ì†Œìˆ˜ì ì„ í¬í•¨í•œ ì „ì²´ ìë¦¿ìˆ˜ë¥¼, scaleì€ ì†Œìˆ˜ì˜ ìë¦¿ìˆ˜ë‹¤. <br> ì°¸ê³ ë¡œ double, float íƒ€ì…ì—ëŠ” ì ìš©ë˜ì§€ ì•ŠëŠ”ë‹¤. ì•„ì£¼ í° ìˆ«ìë‚˜ ì •ë°€í•œ ì†Œìˆ˜ë¥¼ ë‹¤ë£¨ì–´ì•¼ í•  ë•Œë§Œ ì‚¬ìš©í•œë‹¤. |precision=19,scale=2|

- insertable
  - ìˆ˜ì •í–ˆì„ ë•Œ DBì— INSERTí• ê±´ì§€
- updatetable
  - ìˆ˜ì •í–ˆì„ ë•Œ DBì— UPDATE í• ê±´ì§€
- nullable
  - not null ì œì•½ì¡°ê±´
  - falseì¼ ë•Œ NOT NULL

### @Enumerated

- ìë°” enum íƒ€ì…ì„ ë§¤í•‘í•  ë•Œ ì‚¬ìš©
- âš ï¸ ì£¼ì˜! ORDINAL ì‚¬ìš© X
  - ORDINALì€ ENUM ìˆœì„œë¥¼ ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥
    - ex) USER, ADMIN, GUESTë©´ 0,1,2 ìˆœì„œë¡œ ì €ì¥
  - ì´ëŸ° ê²½ìš° ENUM í´ë˜ìŠ¤ í•„ë“œë¥¼ ì¶”ê°€í•  ë•Œ ì•ìª½ì— ìœ„ì¹˜í•˜ê²Œ ë˜ë©´ 0ìœ¼ë¡œ ì €ì¥ë¨ â†’ ê²¹ì¹˜ê²Œ ë˜ë¯€ë¡œ ì–´ë–¤ í•„ë“ ì§€ êµ¬ë¶„í•  ìˆ˜ ì—†ìŒ
  - ë”°ë¼ì„œ STRINGìœ¼ë¡œ ì‚¬ìš© â­

|ì†ì„±| ì„¤ëª…                  |ê¸°ë³¸ê°’|
|---|---------------------|---|
|value|EnumType.ORDINAL: enum ìˆœì„œë¥¼ ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥|EnumType.ORDINAL|
||EnumType.STRING: enum ì´ë¦„ì„ ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥||

### Temporal

- ë‚ ì§œ íƒ€ì…(java.util.Date, java.util.Calendar)ì„ ë§¤í•‘í•  ë•Œ ì‚¬ìš©

|ì†ì„±| ì„¤ëª…                                                                                    |ê¸°ë³¸ê°’|
|---|---------------------------------------------------------------------------------------|--|
|value| TemporalType.DATE: ë‚ ì§œ, ë°ì´í„°ë² ì´ìŠ¤ date íƒ€ì…ê³¼ ë§¤í•‘ <br> (ì˜ˆ: 2013â€“10â€“11)                        ||
|| TemporalType.TIME: ì‹œê°„, ë°ì´í„°ë² ì´ìŠ¤ time íƒ€ì…ê³¼ ë§¤í•‘ <br> (ì˜ˆ: 11:11:11)                          ||
|| TemporalType.TIMESTAMP: ë‚ ì§œì™€ ì‹œê°„, ë°ì´í„°ë² ì´ìŠ¤ timestamp íƒ€ì…ê³¼ ë§¤í•‘ <br> (ì˜ˆ: 2013â€“10â€“11 11:11:11) ||

```java
@Temporal(TemporalType.TIMESTAMP)   // ë‚ ì§œ,ì‹œê°„ ëª¨ë‘ í¬í•¨
private Date createdDate;

@Temporal(TemporalType.TIMESTAMP)
private Date lastModifiedDate;
```

- í…Œì´ë¸” ìƒì„±
  ```
  createdDate timestamp(6),
  lastModifiedDate timestamp(6)
  ```

- âš ï¸ ì°¸ê³ : LocalDate, LocalDateTimeì„ ì‚¬ìš©í•  ë•ŒëŠ” ìƒëµ ê°€ëŠ¥
  (ìµœì‹  í•˜ì´ë²„ë„¤ì´íŠ¸ ì§€ì›)
- LocalDate, LocalDateTime í•„ë“œìƒì„±
```
private LocalDate testLocalDate;
private LocalDateTime testLocalDateTime;
```
- í…Œì´ë¸” ìƒì„±

    ```
    testLocalDate date,
    testLocalDateTime timestamp(6)
    ```

  - @Temporal ì–´ë…¸í…Œì´ì…˜ì„ ì§€ì •í•˜ì§€ ì•Šì•„ë„ íƒ€ì…ì´ ì •í•´ì§

### @Lob

- ë°ì´í„°ë² ì´ìŠ¤ BLOB, CLOB íƒ€ì…ê³¼ ë§¤í•‘
- @Lobì—ëŠ” ì§€ì •í•  ìˆ˜ ìˆëŠ” ì†ì„±ì´ ì—†ë‹¤
- ë§¤í•‘í•˜ëŠ” í•„ë“œ íƒ€ì…ì´ ë¬¸ìë©´ CLOB ë§¤í•‘, ë‚˜ë¨¸ì§€ëŠ” BLOB ë§¤í•‘
  - CLOB: String, char[], java.sql.CLOB
  - BLOB: byte[], java.sql.BLOB

```
@Lob    // DBì— í° ì»¨í…ì¸ ë¥¼ ë„£ê³  ì‹¶ì„ ë•Œ
private String description;
```

- í…Œì´ë¸” ìƒì„±

    ```
    description clob
    ```

  - Stringì´ë¯€ë¡œ clobíƒ€ì…ìœ¼ë¡œ ìƒì„±ë¨

### @Transient

- í•„ë“œ ë§¤í•‘X
- ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥X, ì¡°íšŒX
- ì£¼ë¡œ ë©”ëª¨ë¦¬ìƒì—ì„œë§Œ ì„ì‹œë¡œ ì–´ë–¤ ê°’ì„ ë³´ê´€í•˜ê³  ì‹¶ì„ ë•Œ ì‚¬ìš©

<br>

## ê¸°ë³¸ í‚¤ ë§¤í•‘

### ê¸°ë³¸ í‚¤ ë§¤í•‘ ì–´ë…¸í…Œì´ì…˜

- `@Id`
- `@GeneratedValue`

```jsx
@Id // JPAì—ê²Œ PKê°€ ë­”ì§€ ì•Œë ¤ì¤Œ
@GeneratedValue(strategy = GenerationType.AUTO)
```

- `GenerationType.AUTO`: ê¸°ë³¸ ê°’, DB ë°©ì–¸ì— ë§ì¶°ì„œ ì…‹íŒ…í•´ì¤Œ
- `GenerationType.SEQUENCE`: ì˜¤ë¼í´ì—ì„œ ì£¼ë¡œ ì‚¬ìš©

### ê¸°ë³¸ í‚¤ ë§¤í•‘ ë°©ë²•

- ì§ì ‘ í• ë‹¹: `@Id`ë§Œ ì‚¬ìš©
- ìë™ ìƒì„±(`@GeneratedValue`)
  - IDENTITY: ë°ì´í„°ë² ì´ìŠ¤ì— ìœ„ì„, MySQL
  - SEQUENCE: ë°ì´í„°ë² ì´ìŠ¤ ì‹œí€€ìŠ¤ ì˜¤ë¸Œì íŠ¸ ì‚¬ìš©, ORACLE
    - `@SequenceGenerator` í•„ìš”
  - TABLE: í‚¤ ìƒì„±ìš© í…Œì´ë¸” ì‚¬ìš©, ëª¨ë“  DBì—ì„œ ì‚¬ìš©
    - `@TableGenerator` í•„ìš”
  - AUTO: ë°©ì–¸ì— ë”°ë¼ ìë™ ì§€ì •, ê¸°ë³¸ê°’

### ì§ì ‘ í• ë‹¹
- @Id ì‚¬ìš©

### IDENTITY ì „ëµ

> íŠ¹ì§•

- ê¸°ë³¸ í‚¤ ìƒì„±ì„ ë°ì´í„°ë² ì´ìŠ¤ì— ìœ„ì„
- ì£¼ë¡œ MySQL, PostgreSQL, SQL Server, DB2ì—ì„œ ì‚¬ìš©
  (MySQLì˜ AUTO_INCREMENT)
- JPAëŠ” ë³´í†µ íŠ¸ëœì­ì…˜ ì»¤ë°‹ ì‹œì ì— INSERT SQL ì‹¤í–‰
- AUTO_INCREMENTëŠ” ë°ì´í„°ë² ì´ìŠ¤ì— INSERT SQLì„ ì‹¤í–‰í•œ ì´í›„ì— ID ê°’ì„ ì•Œ ìˆ˜ ìˆìŒ
- IDENTITY ì „ëµì€ **em.persist() ì‹œì ì— ì¦‰ì‹œ INSERT SQL ì‹¤í–‰**í•˜ê³  DBì—ì„œ ì‹ë³„ìë¥¼ ì¡°íšŒ


<details>
      <summary>JpaMain.java</summary>

    Member member = new Member();
    member.setUsername("B");
    
    System.out.println("=======================");
    em.persist(member);
    System.out.println("member.getId() = " + member.getId());
    System.out.println("=======================");
    
    tx.commit();

</details>

<details>
      <summary>ì¶œë ¥ ê²°ê³¼</summary>

    =======================
    Hibernate: 
        /* insert for
            hellojpa.Member */insert 
        into
            Member (name, id) 
        values
            (?, default)
    member.getId() = 1
    =======================

- ì¶œë ¥ ê²°ê³¼ë¥¼ ë³´ë©´ persist();ë¥¼ í•  ë•Œ INSERT SQLë¬¸ì´ DBë¡œ ë‚ ë¼ê°„ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤
- commit ë˜ê¸° ì „ DBì—ì„œ ì‹ë³„ìë¥¼ ì¡°íšŒí•´ì˜¨ë‹¤

</details>

### IDENTITY ì „ëµ

> ë§¤í•‘

```
@Id
@GeneratedValue(strategy = GenerationType.IDENTITY)
private Long id;
```

```
Member member = new Member();
member.setUsername("C");

em.persist(member);

tx.commit();
```

<img src="https://github.com/iieunji023/jpa-with-spring-boot-basic/blob/main/images/identity_ê²°ê³¼.png" width="200">

- ìë™ìœ¼ë¡œ ID ê°’ 1 ìƒì„±

### SEQUENCE ì „ëµ

> íŠ¹ì§•
>
- ë°ì´í„°ë² ì´ìŠ¤ ì‹œí€€ìŠ¤ëŠ” ìœ ì¼í•œ ê°’ì„ ìˆœì„œëŒ€ë¡œ ìƒì„±í•˜ëŠ” íŠ¹ë³„í•œ ë°ì´í„°ë² ì´ìŠ¤ ì˜¤ë¸Œì íŠ¸
  (ì˜¤ë¼í´ ì‹œí€€ìŠ¤)
- ì˜¤ë¼í´, PostgreSQL, DB2, H2 ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì‚¬ìš©

### SEQUENCE ì „ëµ

> ë§¤í•‘

```
@Entity 
@SequenceGenerator(name="member_seq_generator",
                   sequenceName = "member_seq")  // ë§¤í•‘í•  ë°ì´í„°ë² ì´ìŠ¤ ì‹œí€€ìŠ¤ ì´ë¦„
public class Member {
    @GeneratedValue(strategy = GenerationType.SEQUENCE, generator = "member_seq_generator")
    private Long id;   
}
```

<details>
      <summary>ì¶œë ¥ ê²°ê³¼</summary>

    Hibernate: 
    drop table if exists Member cascade 
    Hibernate:
    drop sequence if exists member_seq
    Hibernate:
    create sequence member_seq start with 1 increment by 50
    Hibernate:
    create table Member (
    id bigint not null,
    name varchar(255) not null,
    primary key (id)
    )
    Hibernate:
    select
    next value for member_seq
    Hibernate:
    /* insert for
    hellojpa.Member */insert
    into
    Member (name, id)
    values
    (?, ?)

</details>

### SEQUENCE ì „ëµ

> @SequenceGenerator

|ì†ì„±| ì„¤ëª…                                                                                |ê¸°ë³¸ê°’|
|---|-----------------------------------------------------------------------------------|---|
|name| ì‹ë³„ì ìƒì„±ê¸° ì´ë¦„                 |í•„ìˆ˜|
|sequenceName| ë°ì´í„°ë² ì´ìŠ¤ì— ë“±ë¡ë˜ì–´ ìˆëŠ” ì‹œí€€ìŠ¤ ì´ë¦„     |hibernate_sequence|
|initialValue| DDL ìƒì„± ì‹œì—ë§Œ ì‚¬ìš©ë¨, ì‹œí€€ìŠ¤ DDLì„ ìƒì„±í•  ë•Œ ì²˜ìŒ 1 ì‹œì‘í•˜ëŠ” ìˆ˜ë¥¼ ì§€ì •í•œë‹¤. ||
|allocationSize| ì‹œí€€ìŠ¤ í•œ ë²ˆ í˜¸ì¶œì— ì¦ê°€í•˜ëŠ” ìˆ˜(ì„±ëŠ¥ ìµœì í™”ì— ì‚¬ìš©ë¨) <br> ë°ì´í„°ë² ì´ìŠ¤ ì‹œí€€ìŠ¤ ê°’ì´ í•˜ë‚˜ì”© ì¦ê°€í•˜ë„ë¡ ì„¤ì •ë˜ì–´ ìˆìœ¼ë©´ ì´ ê°’ì„ ë°˜ë“œì‹œ 1ë¡œ ì„¤ì •í•´ì•¼ í•œë‹¤ ||
|catalog, schema| ë°ì´í„°ë² ì´ìŠ¤ catalog, schema ì´ë¦„  ||

â­ ì„±ëŠ¥ ìµœì í™”
```
@Entity // JPAë¥¼ ì‚¬ìš©í•˜ëŠ” í´ë˜ìŠ¤ë¼ëŠ” ê²ƒì„ ì¸ì‹
@TableGenerator( name = "MEMBER_SEQ_GENERATOR",
                 table = "MY_SEQUENCES",
                 pkColumnValue = "MEMBER_SEQ", allocationSize = 1)
public class Member {
    
    @Id // JPAì—ê²Œ PKê°€ ë­”ì§€ ì•Œë ¤ì¤Œ
    // GenerationType.AUTO: ê¸°ë³¸ ê°’, DB ë°©ì–¸ì— ë§ì¶°ì„œ ì…‹íŒ…í•´ì¤Œ
    // GenerationType.SEQUENCE: ì˜¤ë¼í´ì—ì„œ ì£¼ë¡œ ì‚¬ìš©
    @GeneratedValue(strategy = GenerationType.TABLE, generator = "MEMBER_SEQ_GENERATOR")
    private Long id;
```
- ì¶œë ¥ ê²°ê³¼

    ```
    Hibernate: 
        create sequence MEMBER_SEQ start with 1 increment by 1
    Hibernate: 
        create table Member (
            id bigint not null,
            name varchar(255) not null,
            primary key (id)
        )
    =======================
    Hibernate: 
        select
            next value for MEMBER_SEQ
    member.getId() = 1
    =======================
    Hibernate: 
        /* insert for
            hellojpa.Member */insert 
        into
            Member (name, id) 
        values
            (?, ?)
    ```

  - `create sequence MEMBER_SEQ start with 1 increment by 1`
    - 1ë¶€í„° ì‹œì‘í•˜ê³  í•˜ë‚˜ì”© ì¦ê°€ì‹œì¼œë¼
  - ê·¸ë ‡ë‹¤ë©´ ì»¬ëŸ¼ì— ê°’ì„ ë„£ì„ ë•Œë§ˆë‹¤ ë„¤íŠ¸ì›Œí¬ë¥¼ ì™”ë‹¤ê°”ë‹¤ í•´ì•¼í•˜ì§€ ì•ŠëŠ”ê°€? ì„±ëŠ¥ ì¸¡ë©´ì—ì„œ ì•ˆì¢‹ì€ ê²ƒ ì•„ë‹Œê°€?
  - ì‹¤ì œ ì¶œë ¥ ê²°ê³¼ë¥¼ ë³´ë©´ `next value for MEMBER_SEQ` ê°€ 3ë²ˆ í˜¸ì¶œë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤

      ```
      Hibernate: 
          select
              next value for MEMBER_SEQ
      Hibernate: 
          select
              next value for MEMBER_SEQ
      Hibernate: 
          select
              next value for MEMBER_SEQ
      member.getId() = 1
      member2.getId() = 2
      member3.getId() = 3
      ```

  - ê·¸ë˜ì„œ allocationSizeëŠ” 50ì´ Default!
  - Whyâ“ [ì°¸ê³ ](https://mgyo.tistory.com/823)
    - allocationSizeì— í• ë‹¹í•œ ê°’ë§Œí¼ **í•œë²ˆì— ì‹œí€€ìŠ¤ ê°’ì„ ì¦ê°€**ì‹œí‚¤ê³  ë‚˜ì„œ **ë©”ëª¨ë¦¬ì— ì‹œí€€ìŠ¤ ê°’ì„ í• ë‹¹**í•œë‹¤
    - allocationSize = 50ì´ë©´, ì‹œí€€ìŠ¤ë¥¼ í•œë²ˆì— 50ì„ ì¦ê°€ì‹œí‚¨ ë‹¤ìŒ 1~50ê¹Œì§€ëŠ” ë©”ëª¨ë¦¬ì— í• ë‹¹
    - ê·¸ë¦¬ê³  51ì´ ë˜ë©´ ì‹œí€€ìŠ¤ ê°’ì„ 100ìœ¼ë¡œ ì¦ê°€ì‹œí‚¨ ë‹¤ìŒ 51~100ê¹Œì§€ ë©”ëª¨ë¦¬ì— ì‹ë³„ìë¥¼ í• ë‹¹

        ```
        Hibernate: 
            select
                next value for MEMBER_SEQ
        Hibernate: 
            select
                next value for MEMBER_SEQ
        member.getId() = 1
        member2.getId() = 2
        member3.getId() = 3
        ```

      - SEQê°€ 2ë²ˆë§Œ í˜¸ì¶œë¨
      - ì²«ë²ˆì§¸ SEQ 1ì„ í˜¸ì¶œ
      - ë‘ë²ˆì§¸ SEQ 51ì„ í˜¸ì¶œí•˜ë©´ì„œ 51ê¹Œì§€ëŠ” SEQê°€ í˜¸ì¶œë˜ì§€ ì•ŠëŠ”ë‹¤!

### TABLE ì „ëµ

- í‚¤ ìƒì„± ì „ìš© í…Œì´ë¸”ì„ í•˜ë‚˜ ë§Œë“¤ì–´ì„œ ë°ì´í„°ë² ì´ìŠ¤ ì‹œí€€ìŠ¤ë¥¼ í‰ë‚´ë‚´ëŠ” ì „ëµ
- ì¥ì : ëª¨ë“  ë°ì´í„°ë² ì´ìŠ¤ì— ì ìš© ê°€ëŠ¥
- ë‹¨ì : ì„±ëŠ¥

### TABLE ì „ëµ

> ë§¤í•‘

```
@Entity  
@TableGenerator( 
        name = "MEMBER_SEQ_GENERATOR", 
        table = "MY_SEQUENCES", 
        pkColumnValue = "MEMBER_SEQ", allocationSize = 1) 
public class Member { 
    @Id 
    @GeneratedValue(strategy = GenerationType.TABLE, 
                   generator = "MEMBER_SEQ_GENERATOR") 
    private Long id; 
```

<details>
      <summary>ì¶œë ¥ ê²°ê³¼</summary>

    create table MY_SEQUENCES ( 
    sequence_name varchar(255) not null, 
    next_val bigint, 
    primary key ( sequence_name ) 
    )

</details>

### TABLE ì „ëµ
> `@TableGenerator`

|ì†ì„±| ì„¤ëª…                                                                             | ê¸°ë³¸ê°’                |
|---|--------------------------------------------------------------------------------|--------------------|
|name|ì‹ë³„ì ìƒì„±ê¸° ì´ë¦„               | í•„ìˆ˜                 |
|table|í‚¤ìƒì„± í…Œì´ë¸”ëª… | hibernate_sequence |
|pkColumnName|ì‹œí€€ìŠ¤ ì»¬ëŸ¼ëª…| sequence_name      |
|valueColumnNa|ì‹œí€€ìŠ¤ ê°’ ì»¬ëŸ¼ëª… | next_val           |
|pkColumnValue|í‚¤ë¡œ ì‚¬ìš©í•  ê°’ ì´ë¦„| ì—”í‹°í‹° ì´ë¦„             |
|initialValue|ì´ˆê¸° ê°’, ë§ˆì§€ë§‰ìœ¼ë¡œ ìƒì„±ëœ ê°’ì´ ê¸°ì¤€ì´ë‹¤| 0                  |
|allocationSize|ì‹œí€€ìŠ¤ í•œ ë²ˆ í˜¸ì¶œì— ì¦ê°€í•˜ëŠ” ìˆ˜(ì„±ëŠ¥ ìµœì í™”ì— ì‚¬ìš©ë¨)| 50                 |
|catalog, schema|ë°ì´í„°ë² ì´ìŠ¤ catalog, schema ì´ë¦„||
|uniqueConstraints(DDL)|ìœ ë‹ˆí¬ ì œì•½ ì¡°ê±´ì„ ì§€ì •í•  ìˆ˜ ìˆë‹¤||

### ê¶Œì¥í•˜ëŠ” ì‹ë³„ì ì „ëµ

- ê¸°ë³¸ í‚¤ ì œì•½ ì¡°ê±´: null ì•„ë‹˜, ìœ ì¼, ë³€í•˜ë©´ ì•ˆëœë‹¤
- ë¯¸ë˜ê¹Œì§€ ì´ ì¡°ê±´ì„ ë§Œì¡±í•˜ëŠ” ìì—°í‚¤ëŠ” ì°¾ê¸° ì–´ë µë‹¤.
  - ëŒ€ë¦¬í‚¤(ëŒ€ì²´í‚¤)ë¥¼ ì‚¬ìš©í•˜ì!
  - ì‹œí€€ìŠ¤, UUID
- ì˜ˆë¥¼ ë“¤ì–´ ì£¼ë¯¼ë“±ë¡ë²ˆí˜¸ë„ ê¸°ë³¸ í‚¤ë¡œ ì ì ˆí•˜ì§€ ì•Šë‹¤
- ê¶Œì¥: Longí˜• + ëŒ€ì²´í‚¤ + í‚¤ ìƒì„±ì „ëµ ì‚¬ìš©

<br>

## [ì‹¤ì „ ì˜ˆì œ 1 - ìš”êµ¬ì‚¬í•­ ë¶„ì„ê³¼ ê¸°ë³¸ ë§¤í•‘](https://github.com/iieunji023/jpa-ex01)

### ì—”í‹°í‹° ìƒì„±

<details>
      <summary>Member.java</summary>

    @Entity
    public class Member {
    @Id @GeneratedValue
    @Column(name="MEMBER_ID")
    private Long id;

    private String name;

    private String city;

    private String street;

    private String zipcode;

    public Long getId() {
        return id;
    }

    public void setId(Long id) {
        this.id = id;
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }

    public String getCity() {
        return city;
    }

    public void setCity(String city) {
        this.city = city;
    }

    public String getStreet() {
        return street;
    }

    public void setStreet(String street) {
        this.street = street;
    }

    public String getZipcode() {
        return zipcode;
    }

    public void setZipcode(String zipcode) {
        this.zipcode = zipcode;
    }
    }

</details>

<details>
      <summary>Order.java</summary>

    @Entity
    @Table(name="ORDERS")
    public class Order {
    @Id @GeneratedValue
    @Column(name="ORDER_ID")
    private Long id;

    @Column(name="MEMBER_ID")
    private Long memberId;

    private LocalDateTime orderDate;

    @Enumerated(EnumType.STRING)
    private OrderStatus status;

    public Long getId() {
        return id;
    }

    public void setId(Long id) {
        this.id = id;
    }

    public Long getMemberId() {
        return memberId;
    }

    public void setMemberId(Long memberId) {
        this.memberId = memberId;
    }

    public LocalDateTime getOrderDate() {
        return orderDate;
    }

    public void setOrderDate(LocalDateTime orderDate) {
        this.orderDate = orderDate;
    }

    public OrderStatus getStatus() {
        return status;
    }

    public void setStatus(OrderStatus status) {
        this.status = status;
    }
    }

</details>

<details>
      <summary>Item.java</summary>

    @Entity
    public class Item {
    @Id @GeneratedValue
    @Column(name="ITEM_ID")
    private Long id;

    private String name;

    private int price;

    private int stockQuantity;

    public Long getId() {
        return id;
    }

    public void setId(Long id) {
        this.id = id;
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }

    public int getPrice() {
        return price;
    }

    public void setPrice(int price) {
        this.price = price;
    }

    public int getStockQuantity() {
        return stockQuantity;
    }

    public void setStockQuantity(int stockQuantity) {
        this.stockQuantity = stockQuantity;
    }
    }

</details>

<details>
      <summary>OrderItem.java</summary>

    @Entity
    public class OrderItem {
    @Id @GeneratedValue
    @Column(name="ORDER_ITEM_ID")
    private Long id;

    @Column(name="ORDER_ID")
    private Long orderId;

    @Column(name="ITEM_ID")
    private Long itemId;

    private int orderPrice;

    private int count;

    public Long getId() {
        return id;
    }

    public void setId(Long id) {
        this.id = id;
    }

    public Long getOrderId() {
        return orderId;
    }

    public void setOrderId(Long orderId) {
        this.orderId = orderId;
    }

    public Long getItemId() {
        return itemId;
    }

    public void setItemId(Long itemId) {
        this.itemId = itemId;
    }

    public int getOrderPrice() {
        return orderPrice;
    }

    public void setOrderPrice(int orderPrice) {
        this.orderPrice = orderPrice;
    }

    public int getCount() {
        return count;
    }

    public void setCount(int count) {
        this.count = count;
    }
    }

</details>

<details>
      <summary>OrderStatus.java</summary>

    package com.jpabook.jpashop.domain;

    public enum OrderStatus {
    ORDER, CANCEL;
    }

</details>

### í…Œì´ë¸” ìƒì„±í•˜ê¸°
<details>
      <summary>JpaMain.java</summary>

    public class JpaMain {

    public static void main(String[] args) {

        EntityManagerFactory emf = Persistence.createEntityManagerFactory("hello");
        EntityManager em = emf.createEntityManager();

        EntityTransaction tx = em.getTransaction();
        tx.begin();

        try{
            tx.commit();
        }catch (Exception e){
            tx.rollback();
        }finally {
            em.close();
        }

        emf.close();
    }
    }

</details>
<details>
      <summary>ì¶œë ¥ ê²°ê³¼(í…Œì´ë¸” ìƒì„±)</summary>

    Hibernate: 
    create sequence Item_SEQ start with 1 increment by 50
    14:19:04.278 [main] INFO org.hibernate.orm.connections.access -- HHH10001501: Connection obtained from JdbcConnectionAccess [org.hibernate.engine.jdbc.env.internal.JdbcEnvironmentInitiator$ConnectionProviderJdbcConnectionAccess@27e2287c] for (non-JTA) DDL execution was not in auto-commit mode; the Connection 'local transaction' will be committed and the Connection will be set into auto-commit mode.
    Hibernate:
    create sequence Member_SEQ start with 1 increment by 50
    Hibernate:
    create sequence OrderItem_SEQ start with 1 increment by 50
    Hibernate:
    create sequence ORDERS_SEQ start with 1 increment by 50
    Hibernate:
    create table Item (
    price integer not null,
    stockQuantity integer not null,
    ITEM_ID bigint not null,
    name varchar(255),
    primary key (ITEM_ID)
    )
    Hibernate:
    create table Member (
    MEMBER_ID bigint not null,
    city varchar(255),
    name varchar(255),
    street varchar(255),
    zipcode varchar(255),
    primary key (MEMBER_ID)
    )
    Hibernate:
    create table OrderItem (
    count integer not null,
    orderPrice integer not null,
    ITEM_ID bigint,
    ORDER_ID bigint,
    ORDER_ITEM_ID bigint not null,
    primary key (ORDER_ITEM_ID)
    )
    Hibernate:
    create table ORDERS (
    MEMBER_ID bigint,
    ORDER_ID bigint not null,
    orderDate timestamp(6),
    status varchar(255) check (status in ('ORDER','CANCEL')),
    primary key (ORDER_ID)
    )

</details>

- h2 ì½˜ì†”ì—ì„œ í™•ì¸

<img src="https://github.com/iieunji023/jpa-with-spring-boot-basic/blob/main/images/h2ê²°ê³¼.png" width="200">

### h2 ì½˜ì†” ì—°ê²°
> <persistence.xml>

```
<property name="jakarta.persistence.jdbc.url" value="jdbc:h2:tcp://localhost/~/jpashop"/>
```

- jpashopìœ¼ë¡œ ë³€ê²½


<details>
      <summary>âš ï¸ h2 ì½˜ì†” ì ‘ì† ì•ˆë˜ëŠ” ë¬¸ì œ</summary>
1. ip ì£¼ì†Œ localhostë¡œ ë°”ê¿”ì„œ ì ‘ì†

    [`http://localhost:8082/login.do?jsessionid=e7dc39bdbf019db257539b0508232b51`](http://localhost:8082/login.do?jsessionid=e7dc39bdbf019db257539b0508232b51)

2. jdbc URL: `jdbc:h2:~/jpashop`

</details>

### ë°ì´í„° ì¤‘ì‹¬ ì„¤ê³„ì˜ ë¬¸ì œì 
- í˜„ì¬ ë°©ì‹ì€ ê°ì²´ ì„¤ê³„ë¥¼ í…Œì´ë¸” ì„¤ê³„ì— ë§ì¶˜ ë°©ì‹
- í…Œì´ë¸”ì˜ ì™¸ë˜í‚¤ë¥¼ ê°ì²´ì— ê·¸ëŒ€ë¡œ ê°€ì ¸ì˜´
- ê°ì²´ ê·¸ë˜í”„ íƒìƒ‰ì´ ë¶ˆê°€ëŠ¥
- ì°¸ì¡°ê°€ ì—†ìœ¼ë¯€ë¡œ UMLë„ ì˜ëª»ë¨