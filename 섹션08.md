## ìƒì†ê´€ê³„ ë§¤í•‘

<img src="https://github.com/iieunji023/jpa-with-spring-boot-basic/blob/main/images/ìƒì†ê´€ê³„ë§¤í•‘.png" width="450">

- ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ëŠ” ìƒì† ê´€ê³„ X
- ìŠˆí¼íƒ€ì… ì„œë¸Œíƒ€ì… ê´€ê³„ë¼ëŠ” ëª¨ë¸ë§ ê¸°ë²•ì´ ê°ì²´ ìƒì†ê³¼ ìœ ì‚¬
- ìƒì†ê´€ê³„ ë§¤í•‘: ê°ì²´ì˜ ìƒì†ê³¼ êµ¬ì¡°ì™€ DBì˜ ìŠˆí¼íƒ€ì… ì„œë¸Œíƒ€ì… ê´€ê³„ë¥¼ ë§¤í•‘
- ìŠˆí¼íƒ€ì… ì„œë¸Œíƒ€ì… ë…¼ë¦¬ ëª¨ë¸ì„ ì‹¤ì œ ë¬¼ë¦¬ ëª¨ë¸ë¡œ êµ¬í˜„í•˜ëŠ” ë°©ë²•
    - ê°ê° í…Œì´ë¸”ë¡œ ë³€í™˜ â†’ ì¡°ì¸ ì „ëµ
    - í†µí•© í…Œì´ë¸”ë¡œ ë³€í™˜ â†’ ë‹¨ì¼ í…Œì´ë¸” ì „ëµ
    - ì„œë¸Œíƒ€ì… í…Œì´ë¸”ë¡œ ë³€í™˜ â†’ êµ¬í˜„ í´ë˜ìŠ¤ë§ˆë‹¤ í…Œì´ë¸” ì „ëµ

### ì£¼ìš” ì–´ë…¸í…Œì´ì…˜

- `@Inheritance(strategy=Inheritance.Type.XXX)`
    - JOINED: ì¡°ì¸ ì „ëµ
    - SINGLE_TABLE: ë‹¨ì¼ í…Œì´ë¸” ì „ëµ
    - TABLE_PER_CLASS: êµ¬í˜„ í´ë˜ìŠ¤ë§ˆë‹¤ í…Œì´ë¸” ì „ëµ
- `@DiscriminatorColumn(name=â€DTYPEâ€)`
- `@DiscriminatorValue(â€XXXâ€)`

### ì¡°ì¸ì „ëµ

<img src="https://github.com/iieunji023/jpa-with-spring-boot-basic/blob/main/images/ì¡°ì¸ì „ëµ.png" width="450">

> **ì˜ˆì‹œ ì½”ë“œ**

ğŸ”¸ í…Œì´ë¸” ìƒì„±
<details>
      <summary>ë¶€ëª¨ í´ë˜ìŠ¤ì¸ Item ì—”í‹°í‹°</summary>

```
@Entity
@Inheritance(strategy = InheritanceType.JOINED) // ì¡°ì¸ ì „ëµ
public class Item {
    @Id @GeneratedValue
    public Long id;

    private String name;
    private int price;

}

```

- @Inheritance ì‚¬ìš©

</details>
<details>
      <summary>í…Œì´ë¸” ìƒì„± ê²°ê³¼</summary>

```
Hibernate: 
    create table Album (
        id bigint not null,
        artist varchar(255),
        primary key (id)
    )
Hibernate: 
    create table Book (
        id bigint not null,
        author varchar(255),
        isbn varchar(255),
        primary key (id)
    )
Hibernate: 
    create table Item (
        price integer not null,
        id bigint not null,
        name varchar(255),
        primary key (id)
    )
Hibernate: 
    create table Movie (
        id bigint not null,
        actor varchar(255),
        director varchar(255),
        primary key (id)
    )

```

</details>

ğŸ”¸ DBì— ê°’ ë„£ê¸°
<details>
      <summary>JpaMain.java</summary>

```
Movie movie = new Movie();

movie.setDirector("aaaa");
movie.setActor("bbbb");
movie.setName("ë°”ëŒê³¼í•¨ê»˜ì‚¬ë¼ì§€ë‹¤");
movie.setPrice(10000);

em.persist(movie);

tx.commit();

```

- item album pk ë™ì¼
  - item, album insert 2ë²ˆ ì´ë£¨ì–´ì§
  - êµ¬ë¶„í•  ìˆ˜ ìˆì–´ì•¼ í•¨
  - dtypeì´ë¼ëŠ” ì»¬ëŸ¼ì„ í†µí•´ ì•¨ë²”ì´ë©´ album í…Œì´ë¸”ì—ì„œ ê°’ ê°€ì ¸ì˜¤ëŠ” ë°©ì‹ìœ¼ë¡œ ì§„í–‰

</details>

ğŸ”¸ h2 ì½˜ì†” í™•ì¸

<img src="https://github.com/iieunji023/jpa-with-spring-boot-basic/blob/main/images/ì¡°ì¸ì „ëµ2.png" width="200">

- ê°’ì´ ì˜ ë“¤ì–´ê°„ ê²ƒ í™•ì¸

ğŸ”¸ DB ë°ì´í„° ì¡°íšŒí•˜ê¸°
<details>
      <summary>JpaMain.java</summary>

```
Movie movie = new Movie();

movie.setDirector("aaaa");
movie.setActor("bbbb");
movie.setName("ë°”ëŒê³¼í•¨ê»˜ì‚¬ë¼ì§€ë‹¤");
movie.setPrice(10000);

em.persist(movie);

em.flush();
em.clear();

Movie findMovie = em.find(Movie.class, movie.getId());
System.out.println("findMovie = " + findMovie);

tx.commit();

```

- ì¶œë ¥ê²°ê³¼
  ```
  Hibernate: 
    select
        m1_0.id,
        m1_1.name,
        m1_1.price,
        m1_0.actor,
        m1_0.director 
    from
        Movie m1_0 
    join
        Item m1_1 
            on m1_0.id=m1_1.id 
    where
        m1_0.id=?
    findMovie = hellojpa.Movie@798deee8
  ```

  - ì¡°ì¸ìœ¼ë¡œ ê°€ì ¸ì˜¤ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŒ

</details>

> **ì¥ì **

- í…Œì´ë¸” ì •ê·œí™”
- ì™¸ë˜ í‚¤ ì°¸ì¡° ë¬´ê²°ì„± ì œì•½ì¡°ê±´ í™œìš©ê°€ëŠ¥
- ì €ì¥ê³µê°„ íš¨ìœ¨í™”

> **ë‹¨ì **

- ì¡°íšŒì‹œ ì¡°ì¸ì„ ë§ì´ ì‚¬ìš©, ì„±ëŠ¥ ì €í•˜
- ì¡°íšŒ ì¿¼ë¦¬ê°€ ë³µì¡í•¨
- ë°ì´í„° ì €ì¥ì‹œ INSERT SQL 2ë²ˆ í˜¸ì¶œ

### ë‹¨ì¼ í…Œì´ë¸” ì „ëµ

<img src="https://github.com/iieunji023/jpa-with-spring-boot-basic/blob/main/images/ë‹¨ì¼í…Œì´ë¸”ì „ëµ.png" width="450">

> **ì˜ˆì‹œ ì½”ë“œ**
>
- í•˜ë‚˜ì˜ í…Œì´ë¸”ì— ëª¨ë“  ì»¬ëŸ¼ì„ ë„£ì€ ë’¤ DTYPEìœ¼ë¡œ êµ¬ë¶„í•˜ì!

ğŸ”¸ ë¶€ëª¨í´ë˜ìŠ¤ì¸ Item ì—”í‹°í‹°ì—ì„œ `@Inheritance` ì–´ë…¸í…Œì´ì…˜ì„ ì‚¬ìš©í•´ì„œ ë³€ê²½
<details>
      <summary>Item.java</summary>

```
@Entity
@Inheritance(strategy = InheritanceType.SINGLE_TABLE)
@DiscriminatorColumn
public class Item {}

```

</details>
<details>
      <summary>í…Œì´ë¸” ìƒì„± ê²°ê³¼</summary>

```
Hibernate: 
    create table Item (
        price integer not null,
        id bigint not null,
        DTYPE varchar(31) not null,
        actor varchar(255),
        artist varchar(255),
        author varchar(255),
        director varchar(255),
        isbn varchar(255),
        name varchar(255),
        primary key (id)
    )

```

</details>

ğŸ”¸ h2 ì½˜ì†” í™•ì¸

<img src="https://github.com/iieunji023/jpa-with-spring-boot-basic/blob/main/images/ë‹¨ì¼í…Œì´ë¸”ì „ëµ2.png" width="200">

> **ì¥ì **

- ì¡°ì¸ì´ í•„ìš” ì—†ìœ¼ë¯€ë¡œ ì¼ë°˜ì ìœ¼ë¡œ ì¡°íšŒ ì„±ëŠ¥ì´ ë¹ ë¦„
- ì¡°íšŒ ì¿¼ë¦¬ê°€ ë‹¨ìˆœí•¨

> **ë‹¨ì **

- ìì‹ ì—”í‹°í‹°ê°€ ë§¤í•‘í•œ ì»¬ëŸ¼ì€ ëª¨ë‘ null í—ˆìš©
- ë‹¨ì¼ í…Œì´ë¸”ì— ëª¨ë“  ê²ƒì„ ì €ì¥í•˜ë¯€ë¡œ í…Œì´ë¸”ì´ ì»¤ì§ˆ ìˆ˜ ìˆë‹¤.
- ìƒí™©ì— ë”°ë¼ ì¡°íšŒ ì„±ëŠ¥ì´ ì˜¤íˆë ¤ ëŠë ¤ì§ˆ ìˆ˜ ìˆë‹¤.

### DTYPE ì„¤ì •

<details>
      <summary>Item ì—”í‹°í‹°ì— @DiscriminatorColumn ì–´ë…¸í…Œì´ì…˜ ì¶”ê°€</summary>

```
@Entity
@Inheritance(strategy = InheritanceType.JOINED) // ì¡°ì¸ ì „ëµ
@DiscriminatorColumn
public class Item {}

```

</details>
<details>
      <summary>í…Œì´ë¸” ìƒì„± ê²°ê³¼</summary>

```
Hibernate: 
    create table Item (
        price integer not null,
        id bigint not null,
        DTYPE varchar(31) not null,
        name varchar(255),
        primary key (id)
    )

```

- Item í…Œì´ë¸” ì»¬ëŸ¼ì— DTYPEì´ í•¨ê»˜ ì¶”ê°€ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŒ

</details>

ğŸ”¸ h2 ì½˜ì†” í™•ì¸

<img src="https://github.com/iieunji023/jpa-with-spring-boot-basic/blob/main/images/dtype.png" width="200">

- DTYPEì— Movieê°€ ë“¤ì–´ê°„ ê²ƒì„ í™•ì¸
- DTYPEì—ëŠ” ì—”í‹°í‹°ëª…ì´ ë“¤ì–´ê°„ë‹¤
- ë§Œì•½ ê¸°ë³¸ ì—”í‹°í‹°ëª…ì´ ì•„ë‹ˆë¼ ì›í•˜ëŠ” ëŒ€ë¡œ ë„£ê³  ì‹¶ë‹¤ë©´ ìì‹ ì—”í‹°í‹°ì—ì„œ @DiscriminatorValue ì–´ë…¸í…Œì´ì…˜ ì‚¬ìš©
  ```
  @Entity
  @DiscriminatorValue("A")
  public class Album extends Item{}
  
  @Entity
  @DiscriminatorValue("M")
  public class Movie extends Item {}
  
  @Entity
  @DiscriminatorValue("B")
  public class Book extends Item{}
  ```

  <img src="https://github.com/iieunji023/jpa-with-spring-boot-basic/blob/main/images/dtype2.png" width="200">
  
  - Movieì—ì„œ Mìœ¼ë¡œ ë°”ë€ ê²ƒ í™•ì¸

### êµ¬í˜„ í´ë˜ìŠ¤ë§ˆë‹¤ í…Œì´ë¸” ì „ëµ

- **ì´ ì „ëµì€ ë°ì´í„°ë² ì´ìŠ¤ ì„¤ê³„ìì™€ ORM ì „ë¬¸ê°€ ë‘˜ ë‹¤ ì¶”ì²œX**

> **ì˜ˆì‹œì½”ë“œ**

- Item í´ë˜ìŠ¤ë¥¼ ì—†ì• ê³  ê°ê° ìƒí’ˆì— ì¤‘ë³µë˜ëŠ” ì»¬ëŸ¼ ì¶”ê°€

ğŸ”¸ ë¶€ëª¨í´ë˜ìŠ¤ì¸ Item ì—”í‹°í‹°ì—ì„œ `@Inheritance` ì–´ë…¸í…Œì´ì…˜ì„ ì‚¬ìš©í•´ì„œ ë³€ê²½

<details>
      <summary>Item.java</summary>

```
@Entity
@Inheritance(strategy = InheritanceType.TABLE_PER_CLASS) 
@DiscriminatorColumn
public abstract class Item {}

```

- Item í…Œì´ë¸” ì»¬ëŸ¼ì— DTYPEì´ í•¨ê»˜ ì¶”ê°€ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŒ

</details>
<details>
      <summary>í…Œì´ë¸” ìƒì„± ê²°ê³¼</summary>

```
Hibernate: 
    create table Album (
        price integer not null,
        id bigint not null,
        artist varchar(255),
        name varchar(255),
        primary key (id)
    )
Hibernate: 
    create table Book (
        price integer not null,
        id bigint not null,
        author varchar(255),
        isbn varchar(255),
        name varchar(255),
        primary key (id)
    )
Hibernate: 
    create table Movie (
        price integer not null,
        id bigint not null,
        actor varchar(255),
        director varchar(255),
        name varchar(255),
        primary key (id)
    )

```

- Item í…Œì´ë¸” ì»¬ëŸ¼ì— DTYPEì´ í•¨ê»˜ ì¶”ê°€ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŒ

</details>

ğŸ”¸ h2 ì½˜ì†” í™•ì¸

<img src="https://github.com/iieunji023/jpa-with-spring-boot-basic/blob/main/images/í´ë˜ìŠ¤ë§ˆë‹¤í…Œì´ë¸”.png" width="200">

- ì»¬ëŸ¼ ì¤‘ë³µë˜ëŠ” ê²ƒ í™•ì¸

> ì¥ì 

- ì„œë¸Œ íƒ€ì…ì„ ëª…í™•í•˜ê²Œ êµ¬ë¶„í•´ì„œ ì²˜ë¦¬í•  ë•Œ íš¨ê³¼ì 
- NOT NULL ì œì•½ì¡°ê±´ ì‚¬ìš© ê°€ëŠ¥

> ë‹¨ì 

- ì—¬ëŸ¬ ìì‹ í…Œì´ë¸”ì„ í•¨ê»˜ ì¡°íšŒí•  ë•Œ ì„±ëŠ¥ì´ ëŠë¦¼(UNION SQL í•„ìš”)
- ìì‹ í…Œì´ë¸”ì„ í†µí•©í•´ì„œ ì¿¼ë¦¬í•˜ê¸° ì–´ë ¤ì›€